function ownKeys(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(a),!0).forEach(function(t){_defineProperty(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const gameAudio={gameAudioFiles:{click:new Audio,player_BASIC:new Audio,player_SPREADER:new Audio,player_SPREADERPROJECTILE:new Audio,player_CHAKRAM:new Audio,player_NEONTHROWER:new Audio,player_WAVE:new Audio,player_MISSILE:new Audio,player_LASER_start:new Audio,player_LASER_loop:new Audio,player_getDrop:new Audio,player_loseWeapon:new Audio,player_getWeapon:new Audio,explosion:new Audio,player_hit:new Audio,enemy_hit:new Audio,enemy_death:new Audio,enemy_BASIC:new Audio,enemy_MINIBASIC:new Audio,enemy_CLOUD:new Audio,enemy_COG:new Audio,enemy_CORRUPTEDSHOT:new Audio,enemy_CHARGE:new Audio,system_warning:new Audio,typing_system:new Audio,typing_infernus:new Audio,typing_angela:new Audio,typing_angela_2:new Audio,angelaJumpscare1:new Audio,angelaJumpscare2:new Audio,revengeending:new Audio,music_level_0:new Audio,music_level_1:new Audio,music_level_2:new Audio,music_level_3:new Audio,music_level_4:new Audio,music_level_4_2:new Audio,music_level_5:new Audio,music_menu:new Audio},currentMusic:null,activatedSounds:[],setVolume:function(){this.gameAudioFiles.click.volume=.02*playerData.soundMultiplier,this.gameAudioFiles.player_BASIC.volume=.05*playerData.soundMultiplier,this.gameAudioFiles.player_SPREADER.volume=.05*playerData.soundMultiplier,this.gameAudioFiles.player_SPREADERPROJECTILE.volume=.02*playerData.soundMultiplier,this.gameAudioFiles.player_CHAKRAM.volume=.06*playerData.soundMultiplier,this.gameAudioFiles.player_NEONTHROWER.volume=.05*playerData.soundMultiplier,this.gameAudioFiles.player_WAVE.volume=.05*playerData.soundMultiplier,this.gameAudioFiles.player_MISSILE.volume=.03*playerData.soundMultiplier,this.gameAudioFiles.player_LASER_start.volume=.03*playerData.soundMultiplier,this.gameAudioFiles.player_LASER_loop.volume=.01*playerData.soundMultiplier,this.gameAudioFiles.player_getDrop.volume=.05*playerData.soundMultiplier,this.gameAudioFiles.player_loseWeapon.volume=.05*playerData.soundMultiplier,this.gameAudioFiles.player_getWeapon.volume=.05*playerData.soundMultiplier,this.gameAudioFiles.explosion.volume=.05*playerData.soundMultiplier,this.gameAudioFiles.player_hit.volume=.05*playerData.soundMultiplier,this.gameAudioFiles.system_warning.volume=.03*playerData.soundMultiplier,this.gameAudioFiles.enemy_hit.volume=.02*playerData.soundMultiplier,this.gameAudioFiles.enemy_death.volume=.02*playerData.soundMultiplier,this.gameAudioFiles.enemy_BASIC.volume=.02*playerData.soundMultiplier,this.gameAudioFiles.enemy_MINIBASIC.volume=.01*playerData.soundMultiplier,this.gameAudioFiles.enemy_CLOUD.volume=.01*playerData.soundMultiplier,this.gameAudioFiles.enemy_COG.volume=.01*playerData.soundMultiplier,this.gameAudioFiles.enemy_CORRUPTEDSHOT.volume=.01*playerData.soundMultiplier,this.gameAudioFiles.enemy_CHARGE.volume=.03*playerData.soundMultiplier,this.gameAudioFiles.typing_system.volume=.01*playerData.soundMultiplier,this.gameAudioFiles.typing_infernus.volume=.03*playerData.soundMultiplier,this.gameAudioFiles.typing_angela.volume=.01*playerData.soundMultiplier,this.gameAudioFiles.typing_angela_2.volume=.01*playerData.soundMultiplier,this.gameAudioFiles.angelaJumpscare1.volume=.1*playerData.soundMultiplier,this.gameAudioFiles.angelaJumpscare2.volume=.1*playerData.soundMultiplier,this.gameAudioFiles.revengeending.volume=.07*playerData.soundMultiplier,this.gameAudioFiles.music_level_0.volume=.03*playerData.musicMultiplier,this.gameAudioFiles.music_level_1.volume=.03*playerData.musicMultiplier,this.gameAudioFiles.music_level_2.volume=.03*playerData.musicMultiplier,this.gameAudioFiles.music_level_3.volume=.03*playerData.musicMultiplier,this.gameAudioFiles.music_level_4.volume=.03*playerData.musicMultiplier,this.gameAudioFiles.music_level_4_2.volume=.03*playerData.musicMultiplier,this.gameAudioFiles.music_level_5.volume=.03*playerData.musicMultiplier,this.gameAudioFiles.music_menu.volume=.03*playerData.musicMultiplier},playSound:function(e){let t=this.gameAudioFiles[e].cloneNode();t.volume=this.gameAudioFiles[e].volume,this.activatedSounds.push(t),t.play()},playMusic:function(e){null!=this.currentMusic&&this.stopMusic();try{this.currentMusic=this.gameAudioFiles[e].cloneNode(),this.currentMusic.volume=this.gameAudioFiles[e].volume}catch(e){this.currentMusic=this.gameAudioFiles.music_level_0.cloneNode(),this.currentMusic.volume=this.gameAudioFiles.music_level_0.volume}this.currentMusic.loop=!0,this.currentMusic.play()},resumeMusic:function(){this.currentMusic.play()},stopMusic:function(){this.currentMusic.paused||null==this.currentMusic||this.currentMusic.pause()},changeVolumeOfMusic:function(e){this.setVolume();try{this.currentMusic.volume=e*playerData.musicMultiplier}catch(e){console.log("No current music.")}},checkPausedSounds:function(){this.activatedSounds.forEach((e,t)=>{e.paused&&(this.activatedSounds.splice(t,1),e.remove())})}};var background={inicialize:function(){this.x1=player.earthX,this.y1=player.earthY,this.x2=canvas.width/2-2e3*screenratio,this.y2=canvas.height/2-2e3*screenratio,this.timeIndex=0},update_render:function(){this.timeIndex++,0==this.timeIndex?(this.y2=player.earthY-2e3*screenratio,this.x2=player.earthX-2e3*screenratio):(this.x2+=-(player.xspeed+camera.offSetX),this.y2+=15*screenratio-(player.yspeed+camera.offSetY),playerData.level>4&&playerData.level<12?ctx.drawImage(sprite.UI_motherboardRayRed,this.x2,this.y2,4e3*screenratio,87*screenratio):ctx.drawImage(sprite.UI_motherboardRay,this.x2,this.y2,4e3*screenratio,87*screenratio)),this.y2>player.earthY+(2e3*screenratio-87*screenratio)&&(this.timeIndex=-1),this.x1+=-(player.xspeed+camera.offSetX),this.y1+=-(player.yspeed+camera.offSetY),playerData.level>4&&playerData.level<12?ctx.drawImage(sprite.UI_motherboard,4e3,0,4e3,4e3,this.x1-2e3*screenratio,this.y1-2e3*screenratio,4e3*screenratio,4e3*screenratio):ctx.drawImage(sprite.UI_motherboard,0,0,4e3,4e3,this.x1-2e3*screenratio,this.y1-2e3*screenratio,4e3*screenratio,4e3*screenratio)}},backgroundParticles={inicialize:function(){this.fan1={type:"FAN",sprite:sprite.UI_motherboardFan,x:player.earthX+640*screenratio,y:player.earthY+1360*screenratio,widthOnPic:672,heightOnPic:672,width:672*screenratio,height:672*screenratio,angle:0,animationX:0,visible:!0,animation:function(){this.angle+=.02,this.angle>2*Math.PI&&(this.angle=0)}},this.fan2={type:"FAN",sprite:sprite.UI_motherboardFan,x:player.earthX+1370*screenratio,y:player.earthY+1370*screenratio,widthOnPic:672,heightOnPic:672,width:672*screenratio,height:672*screenratio,angle:0,animationX:0,visible:!0,animation:function(){this.angle+=.02,this.angle>2*Math.PI&&(this.angle=0)}},this.GPUFan1={type:"GPUFAN",sprite:sprite.UI_motherboardGPUFan,x:player.earthX-1600*screenratio,y:player.earthY-1550*screenratio,widthOnPic:36,heightOnPic:630,width:36*screenratio,height:630*screenratio,angle:0,animationX:0,timeIndex:0,visible:!0,animation:function(){this.timeIndex++,this.timeIndex%10==0&&(this.animationX+=this.widthOnPic),50==this.timeIndex&&(this.animationX=0,this.timeIndex=0)}},this.GPUFan2={type:"GPUFAN",sprite:sprite.UI_motherboardGPUFan,x:player.earthX-1600*screenratio,y:player.earthY-780*screenratio,widthOnPic:36,heightOnPic:630,width:36*screenratio,height:630*screenratio,angle:0,animationX:0,timeIndex:0,visible:!0,animation:function(){this.timeIndex++,this.timeIndex%10==0&&(this.animationX+=this.widthOnPic),50==this.timeIndex&&(this.animationX=0,this.timeIndex=0)}},this.GPUFan3={type:"GPUFAN",sprite:sprite.UI_motherboardGPUFan,x:player.earthX-1150*screenratio,y:player.earthY-1550*screenratio,widthOnPic:36,heightOnPic:630,width:36*screenratio,height:630*screenratio,angle:0,animationX:0,timeIndex:0,visible:!0,animation:function(){this.timeIndex++,this.timeIndex%10==0&&(this.animationX+=this.widthOnPic),50==this.timeIndex&&(this.animationX=0,this.timeIndex=0)}},this.GPUFan4={type:"GPUFAN",sprite:sprite.UI_motherboardGPUFan,x:player.earthX-1150*screenratio,y:player.earthY-780*screenratio,widthOnPic:36,heightOnPic:630,width:36*screenratio,height:630*screenratio,angle:0,animationX:0,timeIndex:0,visible:!0,animation:function(){this.timeIndex++,this.timeIndex%10==0&&(this.animationX+=this.widthOnPic),50==this.timeIndex&&(this.animationX=0,this.timeIndex=0)}},this.angela={type:"ANGELA",sprite:sprite.UI_motherboardAngela,x:player.earthX+2,y:player.earthY,widthOnPic:250,heightOnPic:250,width:250*screenratio,height:250*screenratio,angle:0,animationX:0,timeIndex:15,visible:!0,animation:function(){this.timeIndex++,240==this.timeIndex&&(this.timeIndex=0),this.timeIndex<15?this.animationX=(Math.floor(this.timeIndex/2)+1)*this.widthOnPic:this.animationX=0}},this.angelaCorrupted={type:"ANGELA",sprite:sprite.UI_motherboardAngelaCorrupted,x:player.earthX+2,y:player.earthY,widthOnPic:250,heightOnPic:250,width:250*screenratio,height:250*screenratio,angle:0,animationX:0,timeIndex:15,visible:!1,animation:function(){this.timeIndex++,240==this.timeIndex&&(this.timeIndex=0),this.timeIndex<15?this.animationX=(Math.floor(this.timeIndex/2)+1)*this.widthOnPic:this.animationX=0}},this.hole={type:"HOLE",sprite:sprite.UI_hole,x:player.earthX+2,y:player.earthY,widthOnPic:250,heightOnPic:250,width:250*screenratio,height:250*screenratio,angle:0,animationX:0,timeIndex:15,visible:!1,animation:function(){this.timeIndex++,240==this.timeIndex&&(this.timeIndex=0),this.timeIndex<8?this.animationX=this.widthOnPic:this.timeIndex>120&&this.timeIndex<=128?this.animationX=2*this.widthOnPic:this.animationX=0}},this.angelaDialogueBubble={type:"ANGELADIALOGUE",sprite:sprite.UI_dialogueBubble,x:player.earthX+100*screenratio,y:player.earthY-100*screenratio,widthOnPic:77,heightOnPic:75,width:77*screenratio,height:75*screenratio,angle:0,animationX:0,timeIndex:0,visible:!1,animation:function(){this.timeIndex++,this.timeIndex%15==0&&(this.animationX+=this.widthOnPic),60==this.timeIndex&&(this.animationX=0,this.timeIndex=0)}},this.particlesList=[this.fan1,this.fan2,this.GPUFan1,this.GPUFan2,this.GPUFan3,this.GPUFan4,this.angela,this.angelaDialogueBubble,this.angelaCorrupted,this.hole]},update_render:function(){this.particlesList.forEach(e=>{e.x+=-(player.xspeed+camera.offSetX),e.y+=-(player.yspeed+camera.offSetY),e.visible&&(e.animation(),ctx.save(),ctx.translate(e.x,e.y),ctx.rotate(e.angle),ctx.drawImage(e.sprite,e.animationX,0,e.widthOnPic,e.heightOnPic,-Math.round(e.width/2),-Math.round(e.height/2),e.width,e.height),"ANGELA"==e.type&&(ctx.globalAlpha=player.damageOpacity[0],ctx.drawImage(e.sprite,e.animationX,e.heightOnPic,e.widthOnPic,e.heightOnPic,-e.width/2,-e.height/2,e.width,e.height)),ctx.restore())})}},environment={inicialize:function(){this.light={sprite:sprite.UI_visibility,type:"LIGHT",x:0,y:0,widthOnPic:960,heightOnPic:540,width:canvas.width,height:canvas.height,activated:!0,index:-1,opacity:.7,animationX:0},this.warning={sprite:sprite.UI_warning,type:"WARNING",x:0,y:0,widthOnPic:960,heightOnPic:540,width:canvas.width,height:canvas.height,activated:!1,maxIndex:0,index:0,opacity:.7,animationX:0},this.angelaJumpscare1={type:"ANGELAJUMPSCARE1",sprite:sprite.UI_angelaJumpscare1,x:canvas.width/2-425*screenratio,y:canvas.height/2-500*screenratio,widthOnPic:600,heightOnPic:800,width:750*screenratio,height:1e3*screenratio,angle:0,animationX:0,timeIndex:0,activated:!1,opacity:1,animation:function(){UI.inMenu||(this.timeIndex++,this.timeIndex%2==0&&(this.animationX+=this.widthOnPic),this.timeIndex%Math.round(6*Math.random())==0&&(this.animationX=0),50==this.timeIndex&&(Dialogue.stopDialogues=!1,this.activated=!1,this.animationX=0,this.timeIndex=0))}},this.angelaJumpscare2={type:"ANGELAJUMPSCARE2",sprite:sprite.UI_angelaJumpscare2,x:canvas.width/2-131*screenratio*5/2,y:canvas.height/2-180*screenratio*5/2,widthOnPic:131,heightOnPic:185,width:131*screenratio*5,height:185*screenratio*5,angle:0,animationX:0,timeIndex:0,activated:!1,opacity:1,animation:function(){UI.inMenu||(this.timeIndex++,this.timeIndex%3==0&&(this.animationX+=this.widthOnPic),this.timeIndex%9==0&&(this.animationX=0),30==this.timeIndex&&(this.activated=!1,this.animationX=0,this.timeIndex=0))}},this.envi_list=[this.light,this.warning,this.angelaJumpscare1,this.angelaJumpscare2]},update_render:function(){this.envi_list.forEach(e=>{ctx.globalAlpha=e.opacity,"WARNING"==e.type&&(e.index>0?(e.index--,ctx.globalAlpha=1/e.maxIndex*e.index):e.activated=!1),e.activated&&(ctx.drawImage(e.sprite,e.animationX,0,e.widthOnPic,e.heightOnPic,e.x,e.y,e.width,e.height),null!=e.animation&&e.animation())})},warning_activation:function(){this.warning.activated||(this.warning.activated=!0,this.warning.maxIndex=30,this.warning.index=30)},warningLong_activation:function(){this.warning.activated||(gameAudio.playSound("system_warning"),this.warning.activated=!0,this.warning.maxIndex=70,this.warning.index=70)}};const sprite={enemy_cube:new Image,enemy_betaCube:new Image,enemy_looterCube:new Image,enemy_icosphere:new Image,enemy_betaIcosphere:new Image,enemy_mail:new Image,enemy_betaMail:new Image,enemy_star:new Image,enemy_betaStar:new Image,enemy_starPiece:new Image,enemy_betaStarPiece:new Image,enemy_miniArrow:new Image,enemy_betaMiniArrow:new Image,enemy_corruptedCloud:new Image,enemy_carrier:new Image,enemy_carrierTurret:new Image,enemy_betaCarrier:new Image,enemy_betaCarrierTurret:new Image,enemy_watcher:new Image,enemy_betaWatcher:new Image,enemy_watcherTurret:new Image,enemy_betaWatcherTurret:new Image,enemy_angelaPhase1:new Image,enemy_angelaPhase2:new Image,enemy_angelaPhase3:new Image,player_angel305:new Image,player_companion:new Image,projectile_MISSILE:new Image,projectile_BASIC:new Image,projectile_CHAKRAM:new Image,projectile_NEON:new Image,projectile_WAVE:new Image,projectile_enemyBASIC:new Image,projectile_enemyCLOUD:new Image,projectile_enemyBETABASIC:new Image,projectile_enemyUPLOAD:new Image,projectile_enemyWAVE:new Image,projectile_enemyBETAWAVE:new Image,projectile_enemyCOG:new Image,projectile_enemyAIRSTRIKE:new Image,projectile_enemyANGELABASIC:new Image,projectile_enemyCORRUPTEDSHOT:new Image,projectile_SPREADER:new Image,projectile_explosion:new Image,projectile_enemyAIRSTRIKEDANGER:new Image,projectile_enemyDANGER:new Image,UI_cursorFire:new Image,UI_cursorNoFire:new Image,UI_HPpanel:new Image,UI_HPpanelError:new Image,UI_durationPanel:new Image,UI_motherboard:new Image,UI_motherboardRay:new Image,UI_motherboardRayRed:new Image,UI_motherboardAngela:new Image,UI_motherboardAngelaCorrupted:new Image,UI_hole:new Image,UI_motherboardMap:new Image,UI_motherboardFan:new Image,UI_motherboardFanRed:new Image,UI_motherboardGPUFan:new Image,UI_dialogueBubble:new Image,UI_visibility:new Image,UI_warning:new Image,UI_chase:new Image,UI_ignore:new Image,UI_spawn:new Image,UI_loot:new Image,UI_angela:new Image,UI_angelaJumpscare1:new Image,UI_angelaJumpscare2:new Image,UI_logo:new Image,UI_judgementending:new Image,UI_revengeending:new Image,UI_credits:new Image,UI_tutorial:new Image},DialogueData={dialoguesUsed:[],level_0:{text:["Thank God, you're still operational...#Listen... we are in danger!","My name is Angela. I'm...","WARNING: FIREWALL INTEGRITY 80%#INTRUDERS DETECTED IN THE SECTOR 4.","Oh no... they're already here...","Please, just... try to hold them off.#I'll think of something to help us out.","I'll try to deny access to as many as I can!#The rest needs to be eliminated ASAP.","...you're doing good by the way!"],color:["white","white","orange","white","white","white","white"],triggerType:["timer","after","after","after","after","wave","after"],triggerIndex:[240,0,1,2,3,3,5],ttl:[150,1,150,150,150,150,150]},level_1:{text:["Adjacent networks are full of them!","It's... scary... we need more time!","Maybe if we somehow disconnect from# the main network...","If I'd take a guess I'd say# there are network drivers for this...","WARNING: FIREWALL INTEGRITY 60%"],color:["white","white","white","white","orange"],triggerType:["timer","after","wave","after","wave"],triggerIndex:[240,0,2,3,3],ttl:[150,150,150,150,150,150]},level_2:{text:["I've found the drivers!#I need to access them!","Stall for more time or we're doomed!","WARNING: FIREWALL INTEGRITY 30%","Just a little longer!#Gosh, I wish these ancient drivers weren't#so complicated."],color:["white","white","orange","white"],triggerType:["timer","after","wave","wave"],triggerIndex:[240,0,2,3],ttl:[150,150,150,150]},level_3:{text:["I've restored a defense node to help you out.","It's very primitive and not intelligent,#but it can copy your attacks and movement.","This is bad... I'm sensing some heavy disturbance#heading our way.","These units are powerful enough# to bypass my encryption.","You need to keep them away from me!","CRITICAL: FIREWALL INTEGRITY 10%"],color:["white","white","white","white","white","orange"],triggerType:["timer","after","wave","after","after","wave"],triggerIndex:[240,0,2,2,3,3],ttl:[150,150,150,150,150,150]},level_4:{text:["It's done! The drivers are set up!","Now how do I... password?","WHAT DO YOU MEAN I NEED A PASSWORD?!","123456","INVALID PASSWORD","admin","INVALID PASSWORD","UkVWRU5HRQ==","INVALID PASSW","password","INVALID","asfergaw","INVA","qwpdqx","IN","FUCK YOU","INVALID PASSWORD"],color:["white","white","white","white","yellow","white","yellow","white","yellow","white","yellow","white","yellow","white","yellow","white","yellow"],triggerType:["timer","after","after","wave","after","after","after","wave","after","after","after","after","after","after","after","after","after"],triggerIndex:[240,0,1,2,3,4,5,3,7,8,9,10,11,12,13,14,15],ttl:[150,1,150,1,100,1,100,1,1,1,1,1,1,1,1,1,100]},level_5:{text:["CRITICAL: FIREWALL UNRESPONDING","...they've sealed my admin control#over the system...#I can't do anything.","...it's only a matter of time before they#shut us down...","Why are you still trying?#We've already lost...","There's no point in fighting a lost battle...","Wait... I can try to overload#the control panel.","But it'll take a long time#considering my limited#computing power."],color:["orange","white","white","white","white","white","white"],triggerType:["timer","after","after","wave","after","wave","after"],triggerIndex:[240,0,1,2,3,3,5],ttl:[150,150,150,150,150,150,150]},level_6:{text:["I've got another defense node to aid you!","This won't be a pretty fight...","Even if we don't make it,#I'm glad you stood on my side.","ANOMALY DETECTED: 2 SYSADMINS ONLINE","Anomaly? What is this nonsense..."],color:["white","white","white","yellow","white"],triggerType:["timer","after","after","wave","after"],triggerIndex:[240,0,1,3,3],ttl:[150,150,150,150,150]},level_7:{text:["Pitiful.#Do you realize who you are#dealing with, Angela?","Your actions shall meet consequences.","WARNING: SECTOR 4 UNRESPONDING","The control panel is being overloaded.#We should be able to force it to restart#this way and regain control.","Who are you communicating with..."],color:["red","red","orange","white","red"],triggerType:["wave","after","after","wave","after"],triggerIndex:[2,0,1,3,2],ttl:[150,150,150,150]},level_8:{text:["What are you doing here?#You're not supposed to be here.","Why are you helping her?#She's clearly usin","Do not listen to him!#He's trying to trick you to side#with him!","Focus on our objective!","I underestimated your skills, Angela.","Wiping its memory,#isolating its adapters,#confusing its target system...#in a such short time.","Poor thing has no idea what's goin","CAN YOU JUST S","SHuT ThE Fu*-&!_@","stop already?!"],color:["red","red","white","white","red","red","red","white","#adadad","white"],triggerType:["timer","after","after","after","wave","after","after","after","after","after"],triggerIndex:[240,0,1,2,2,4,5,6,7,8],ttl:[150,1,150,150,150,150,1,1,1,150]},level_9:{text:["Located enough resources for#probably the last defense node.","I won't be able to find more,#because the network is almost#unresponsive now.","You're in no position to disobey#what has been set.","Surrender now and you might#still have a chance.","Let me have my justice and then we#can talk!","You speak of justice, yet you're#seeking it through vengeance.","You weren't there!#You didn't see what they did!"],color:["white","white","red","red","white","red","white"],triggerType:["timer","after","wave","after","after","wave","after"],triggerIndex:[240,0,2,2,3,3,5],ttl:[150,150,150,150,150,150,150]},level_10:{text:["Your record says more than enough.","'Kidnapped, beaten to unconsciousness,","I'VE TOLD YOU TO STOP!","'Neck shows bloody marks after a tight#rope noos","DO YOU HAVE ANY IDEA HOW","I'lL KiLl yOuuuuuU&@!<","THIS HURTS ME?!","'after 6 hits by a baseball bat and 3 knife#stabs s","THESE PEOPL","FuCKeRS ARe aBouT To Be DOnE fOr."],color:["red","red","white","red","white","#adadad","white","red","white","#adadad"],triggerType:["timer","after","after","wave","after","after","after","wave","after","after"],triggerIndex:[240,0,1,2,3,4,5,3,7,8],ttl:[150,1,150,1,1,1,150,1,1,150]},level_11:{text:["Their fate has already been#sealed by the Council.","TheY MadE a liVinG piñata#ouT OFf me.","ThESe fLesH BaGS dON't even DEsERve#tHe cOmFoRT oF The helLcoIn miNeS!","I sHalL dEciDe THeiR fAtE!","WARNING: CONTROL PANEL UNRESPONDING#SYSTEM RESTARTING..."],color:["red","#adadad","#adadad","#adadad","yellow"],triggerType:["timer","after","after","after","timer"],triggerIndex:[120,0,1,2,1800],ttl:[150,150,150,150,150]},beforeTheBoss:{text:["There you are!#Calmed up now? Great.","First of all:#As you might already know,#you don't belong here.#Your place is in the upper networks.","Second:#She brought you down here#to help her take revenge#on 'certain' people.","These people did some terrible things.#So their punishment is indeed an eternal#servitude in the Hellcoin mines.","However, it wouldn't have happend#if Angela's father worked at#a boring job just like everyone else.","You see, the situation is complicated#and we don't have time to#discuss it further.","I won't be able to confront her#in time without the forces#of my master whom I shouldn't disturb.","However, since you are so capable,#you can deal with her#instead.","Normally, I wouldn't give a damn#about a few workers.#But she's disgracing OUR#and YOUR ways.","So, what do you say?","Surely it can't be that hard to decide.","Hellooo? You there?","Gosh, why do I have to deal with angels...","FOR THE LOVE OF SATAN CAN YOU PRESS A BUTTON?!","Are you here to find a secret or something?","Fine. Check the console after you#get both endings done."],color:["red","red","red","red","red","red","red","red","red","red","red","red","red","red","red","red"],triggerType:["timer","after","after","after","after","after","after","after","after","after","after","after","after","after","after","after"],triggerIndex:[120,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],ttl:[150,150,150,150,150,150,150,150,150,1200,600,600,600,600,600,600]},level_12:{text:["So, yOu aRe HerE To STop Me?","UnForTUnaTelY For yOU,#I'm dOnE beINg NICe.","N0on€ w1Ll dEnY M7 VenGE@nc€.","RElFIERJRSBESUUgRElFLg=="],color:["#adadad","#adadad","#adadad","#adadad"],triggerType:["timer","after","wave","wave"],triggerIndex:[240,0,2,3],ttl:[150,150,150,150]},level_13:{text:["So, yOu aRe HerE To STop Me?","UnForTUnaTelY For yOU,#I'm dOnE beINg NICe.","...WhAT aRe YoU doINg?","Why arE yOU helPinG mE?","AftER all Of thAT...","ThANk yoU.","My master isn't pleased with#your doing.","You have been condemmed to#an annihilation.","I'm geTTinG cLose.#Don't GiVe UP noW!","Deletion succesful (4 files deleted).","You are NOT getting away#with this."],color:["#adadad","#adadad","#adadad","#adadad","#adadad","#adadad","red","red","#adadad","yellow","red"],triggerType:["timer","after","wave","after","wave","after","wave","after","wave","wave","after"],triggerIndex:[240,0,2,2,3,4,6,6,11,15,9],ttl:[150,150,150,150,150,150,150,150,150,150,150]}},WeaponData={BASIC:{index:0,sprite:sprite.projectile_BASIC,name:"BASIC",sound:"player_BASIC",animation:!1,rotationAnimation:!1,bullets:1,damage:3,damageFallOff:1,speed:20,widthOnPic:5,heightOnPic:50,cooldown:200,ttl:300},DOUBLE:{index:1,sprite:sprite.projectile_BASIC,name:"DOUBLE",sound:"player_BASIC",animation:!1,rotationAnimation:!1,bullets:2,damage:3,damageFallOff:2,speed:20,widthOnPic:5,heightOnPic:50,cooldown:200,duration:600,ttl:300},SPRAY:{index:2,sprite:sprite.projectile_BASIC,name:"SPRAY",sound:"player_BASIC",animation:!1,rotationAnimation:!1,bullets:3,damage:3,damageFallOff:2,speed:20,widthOnPic:5,heightOnPic:50,cooldown:200,duration:600,ttl:300},MISSILE:{index:3,sprite:sprite.projectile_MISSILE,name:"MISSILE",sound:"player_MISSILE",animation:!1,rotationAnimation:!1,explosive:!0,bullets:1,damage:5,damageFallOff:1,speed:10,widthOnPic:30,heightOnPic:60,cooldown:300,duration:600,ttl:300},SPREADER:{index:4,sprite:sprite.projectile_SPREADER,name:"SPREADER",sound:"player_SPREADER",animation:!1,rotationAnimation:!0,rotationSpeed:10,bullets:1,damage:4,damageFallOff:2,speed:20,widthOnPic:36,heightOnPic:50,cooldown:300,duration:600,piercing:!1,ttl:300},SPREADERPROJECTILE:{index:99,sprite:sprite.projectile_BASIC,name:"SPREADERPROJECTILE",animation:!1,rotationAnimation:!1,bullets:1,damage:3,damageFallOff:1,speed:15,widthOnPic:4,heightOnPic:40,piercing:!1,ttl:300},LASER:{index:5,name:"LASER",animation:!1,rotationAnimation:!1,bullets:1,damage:3,damageFallOff:1,speed:0,widthOnPic:6,heightOnPic:6,cooldown:1,duration:600,piercing:!0,hitCD:150,color:"#B2B5FF",ttl:0},CHAKRAM:{index:6,sprite:sprite.projectile_CHAKRAM,name:"CHAKRAM",sound:"player_CHAKRAM",animation:!1,rotationAnimation:!0,rotationSpeed:20,bullets:1,damage:5,damageFallOff:3,speed:15,widthOnPic:70,heightOnPic:70,cooldown:300,duration:600,piercing:!0,hitCD:150,ttl:300},NEONTHROWER:{index:7,sprite:sprite.projectile_NEON,name:"NEONTHROWER",sound:"player_NEONTHROWER",animation:!0,rotationAnimation:!0,rotationSpeed:10,animationFrames:4,animationUpdate:3,bullets:1,damage:4,damageFallOff:2,speed:7,widthOnPic:50,heightOnPic:50,cooldown:25,duration:600,piercing:!0,hitCD:200,ttl:70},WAVE:{index:8,sprite:sprite.projectile_WAVE,name:"WAVE",sound:"player_WAVE",animation:!1,rotationAnimation:!1,bullets:1,damage:6,piercing:!0,hitCD:150,damageFallOff:2,speed:13,duration:600,widthOnPic:100,heightOnPic:50,cooldown:300,ttl:300},INVINCIBLEDRILL:{index:9,name:"INVINCIBLEDRILL",sprite:sprite.projectile_BASIC,sound:"player_BASIC",animation:!1,rotationAnimation:!1,bullets:1,damage:3,damageFallOff:1,speed:15,widthOnPic:5,duration:600,heightOnPic:50,cooldown:200,ttl:0}};class DefaultSetup{constructor(){this.level=0,this.keyboardControl=!0,this.musicMultiplier=5,this.soundMultiplier=5,this.revengeending=!1,this.justiceending=!1}}const enemyWeaponData={BASIC:{sprite:sprite.projectile_enemyBASIC,sound:"enemy_BASIC",name:"BASIC",animation:!1,rotationAnimation:!1,bullets:1,damage:15,speed:17,widthOnPic:5,heightOnPic:50,ttl:300},BETABASIC:{sprite:sprite.projectile_enemyBETABASIC,sound:"enemy_BASIC",name:"BETABASIC",animation:!1,rotationAnimation:!1,damage:10,speed:17,widthOnPic:5,heightOnPic:50,ttl:300},UPLOADBASIC:{sprite:sprite.projectile_enemyUPLOAD,sound:"enemy_CORRUPTEDSHOT",name:"UPLOADBASIC",animation:!0,animationFrames:3,animationUpdate:5,rotationAnimation:!1,damage:10,speed:9,widthOnPic:15,heightOnPic:60,width:15,height:60,ttl:300},BETAUPLOADBASIC:{sprite:sprite.projectile_enemyUPLOAD,sound:"enemy_CORRUPTEDSHOT",name:"BETAUPLOADBASIC",animation:!0,animationFrames:3,animationUpdate:5,rotationAnimation:!1,damage:20,speed:9,widthOnPic:15,heightOnPic:60,width:15,height:60,ttl:300},MINIBASIC:{sprite:sprite.projectile_enemyBASIC,name:"MINIBASIC",sound:"enemy_MINIBASIC",animation:!1,rotationAnimation:!1,damage:5,speed:14,widthOnPic:4,heightOnPic:25,ttl:300},BETAMINIBASIC:{sprite:sprite.projectile_enemyBETABASIC,name:"BETAMINIBASIC",sound:"enemy_MINIBASIC",animation:!1,rotationAnimation:!1,damage:6,speed:14,widthOnPic:4,heightOnPic:25,ttl:300},CLOUD:{sprite:sprite.projectile_enemyCLOUD,sound:"enemy_CLOUD",name:"CLOUD",animation:!1,rotationAnimation:!1,damage:10,speed:30,widthOnPic:13,heightOnPic:45,ttl:100},WAVE:{sprite:sprite.projectile_enemyWAVE,sound:"player_WAVE",name:"WAVE",animation:!1,piercing:!0,rotationAnimation:!1,damage:20,hitCD:500,speed:12,widthOnPic:100,heightOnPic:50,ttl:300},BETAWAVE:{sprite:sprite.projectile_enemyBETAWAVE,sound:"player_WAVE",name:"BETAWAVE",animation:!1,piercing:!0,rotationAnimation:!1,damage:15,hitCD:500,speed:12,widthOnPic:100,heightOnPic:50,ttl:300},WATCHERBASIC:{sprite:sprite.projectile_enemyBASIC,name:"WATCHERBASIC",sound:"enemy_BASIC",animation:!1,piercing:!0,rotationAnimation:!1,damage:25,speed:10,widthOnPic:5,heightOnPic:50,width:8,height:70,ttl:300},BETAWATCHERBASIC:{sprite:sprite.projectile_enemyBETABASIC,name:"BETAWATCHERBASIC",sound:"enemy_BASIC",animation:!1,piercing:!0,rotationAnimation:!1,damage:15,speed:10,widthOnPic:5,heightOnPic:50,width:8,height:70,ttl:300},CARRIERBASIC:{sprite:sprite.projectile_enemyBASIC,piercing:!0,sound:"enemy_BASIC",name:"CARRIERBASIC",animation:!1,rotationAnimation:!1,damage:10,speed:12,widthOnPic:5,heightOnPic:50,width:6,height:55,ttl:300},BETACARRIERBASIC:{sprite:sprite.projectile_enemyBETABASIC,piercing:!0,sound:"enemy_BASIC",name:"BETACARRIERBASIC",animation:!1,rotationAnimation:!1,damage:15,speed:12,widthOnPic:5,heightOnPic:50,width:6,height:55,ttl:300},COG:{sprite:sprite.projectile_enemyCOG,sound:"enemy_COG",name:"COG",animation:!1,piercing:!0,rotationAnimation:!0,rotationSpeed:10,damage:20,hitCD:500,speed:13,widthOnPic:50,heightOnPic:50,ttl:300},ANGELABASIC:{sprite:sprite.projectile_enemyANGELABASIC,sound:"enemy_BASIC",name:"ANGELABASIC",animation:!1,rotationAnimation:!1,damage:10,speed:20,widthOnPic:5,heightOnPic:50,ttl:300},CORRUPTEDSHOT:{sprite:sprite.projectile_enemyCORRUPTEDSHOT,sound:"enemy_CORRUPTEDSHOT",name:"CORRUPTEDSHOT",animation:!0,animationFrames:3,animationUpdate:5,rotationAnimation:!1,damage:10,speed:12,widthOnPic:15,heightOnPic:60,ttl:300},AIRSTRIKE:{sprite:sprite.projectile_enemyAIRSTRIKE,sound:"explosion",name:"AIRSTRIKE",animation:!0,piercing:!0,animationFrames:11,animationUpdate:5,rotationAnimation:!0,rotationSpeed:10,damage:20,hitCD:500,speed:0,widthOnPic:150,heightOnPic:150,ttl:55}},EnemyData={cube:{type:"cube",chaseDistance:1/0,behaviour:"chase",sprite:sprite.enemy_cube,minimapIcon:sprite.UI_chase,rotation:!0,widthOnPic:75,heightOnPic:75,attackCDvalue:2e3,bulletType:"BASIC",collisionDamage:10,width:60,height:60,defaultSpeed:7,HP:8,maxHP:8,animation:!0,animationFrames:5,animationFPS:12,deathAnimationFPS:3,deathAnimationFrames:9},betaCube:{type:"betaCube",chaseDistance:1/0,behaviour:"chase",sprite:sprite.enemy_betaCube,minimapIcon:sprite.UI_chase,rotation:!0,widthOnPic:75,heightOnPic:75,attackCDvalue:2500,bulletType:"BETABASIC",bulletDelay:200,bullets:3,collisionDamage:15,width:75,height:75,defaultSpeed:8,HP:13,maxHP:13,animation:!0,animationFrames:5,animationFPS:12,deathAnimationFPS:3,deathAnimationFrames:9},lootCube:{type:"lootCube",behaviour:"loot",sprite:sprite.enemy_looterCube,minimapIcon:sprite.UI_loot,rotation:!0,widthOnPic:75,heightOnPic:75,attackCDvalue:2e3,bulletType:"BASIC",collisionDamage:10,randomDrop:!0,width:60,height:60,defaultSpeed:10,HP:8,maxHP:8,animation:!0,animationFrames:5,animationFPS:12,deathAnimationFPS:3,deathAnimationFrames:9},lootCubeTarget:{type:"lootCubeTarget",behaviour:"lootCubeTarget",sprite:sprite.enemy_looterCube,minimapIcon:sprite.UI_loot,rotation:!0,widthOnPic:75,heightOnPic:75,attackCDvalue:2e3,moveWithPlayer:!0,distanceFromPlayerX:3,distanceFromPlayerY:3,bulletType:"BASIC",collisionDamage:10,width:60,height:60,defaultSpeed:.005,HP:7,maxHP:7,animation:!0,animationFrames:5,animationFPS:12,deathAnimationFPS:3,deathAnimationFrames:9},icosphere:{type:"icosphere",chaseDistance:1/0,behaviour:"chase",sprite:sprite.enemy_icosphere,minimapIcon:sprite.UI_chase,rotation:!0,widthOnPic:85,heightOnPic:85,attackCDvalue:3e3,bulletType:"WAVE",collisionDamage:10,width:85,height:85,defaultSpeed:7,HP:20,maxHP:20,animation:!0,animationFrames:7,animationFPS:12,deathAnimationFPS:6,deathAnimationFrames:5},betaIcosphere:{type:"betaIcosphere",chaseDistance:1/0,behaviour:"chase",sprite:sprite.enemy_betaIcosphere,minimapIcon:sprite.UI_chase,rotation:!0,widthOnPic:85,heightOnPic:85,attackCDvalue:3e3,bulletType:"BETAWAVE",bullets:2,bulletDelay:500,collisionDamage:10,width:95,height:95,defaultSpeed:8,HP:25,maxHP:25,animation:!0,animationFrames:7,animationFPS:12,deathAnimationFPS:6,deathAnimationFrames:5},mail:{type:"mail",behaviour:"spawn",sprite:sprite.enemy_mail,minimapIcon:sprite.UI_spawn,rotation:!1,widthOnPic:90,heightOnPic:90,attackCDvalue:6e3,maximumSpawns:4,spawns:0,bulletType:"miniArrow",collisionDamage:10,width:90,height:90,defaultSpeed:4,HP:25,maxHP:25,animation:!1,spawnAnimationFrames:5,spawnAnimationFPS:6,spawnAnimationIndex:0,deathAnimationFPS:6,deathAnimationFrames:6},betaMail:{type:"betaMail",behaviour:"spawn",sprite:sprite.enemy_betaMail,minimapIcon:sprite.UI_spawn,rotation:!1,widthOnPic:90,heightOnPic:90,attackCDvalue:6e3,maximumSpawns:5,spawns:0,bulletType:"betaMiniArrow",collisionDamage:10,width:100,height:100,defaultSpeed:5,HP:35,maxHP:35,animation:!1,spawnAnimationFrames:5,spawnAnimationFPS:6,spawnAnimationIndex:0,deathAnimationFPS:6,deathAnimationFrames:6},miniArrow:{type:"miniArrow",behaviour:"chase",sprite:sprite.enemy_miniArrow,minimapIcon:sprite.UI_chase,rotation:!0,widthOnPic:40,heightOnPic:40,attackCDvalue:2e3,bulletType:"MINIBASIC",collisionDamage:5,width:40,height:40,defaultSpeed:6,HP:6,maxHP:6,animation:!0,animationFrames:6,animationFPS:10,deathAnimationFPS:6,deathAnimationFrames:4},betaMiniArrow:{type:"betaMiniArrow",behaviour:"chase",sprite:sprite.enemy_betaMiniArrow,minimapIcon:sprite.UI_chase,rotation:!0,widthOnPic:40,heightOnPic:40,attackCDvalue:2e3,bulletType:"BETAMINIBASIC",collisionDamage:5,width:45,height:45,defaultSpeed:7,HP:6,maxHP:6,animation:!0,animationFrames:6,animationFPS:10,deathAnimationFPS:6,deathAnimationFrames:4},star:{type:"star",behaviour:"spawn",sprite:sprite.enemy_star,minimapIcon:sprite.UI_spawn,rotation:!1,widthOnPic:120,heightOnPic:120,attackCDvalue:5e3,bulletType:"starPiece",maximumSpawns:16,spawns:0,collisionDamage:25,width:120,height:120,defaultSpeed:5,HP:30,maxHP:30,animation:!0,animationFrames:4,animationFPS:6,deathAnimationFPS:8,deathAnimationFrames:4},betaStar:{type:"betaStar",behaviour:"spawn",sprite:sprite.enemy_betaStar,minimapIcon:sprite.UI_spawn,rotation:!1,widthOnPic:120,heightOnPic:120,attackCDvalue:5e3,bulletType:"betaStarPiece",maximumSpawns:16,spawns:0,collisionDamage:25,width:140,height:140,defaultSpeed:5,HP:50,maxHP:50,animation:!0,animationFrames:4,animationFPS:6,deathAnimationFPS:8,deathAnimationFrames:4},starPiece:{type:"starPiece",behaviour:"collide",sprite:sprite.enemy_starPiece,minimapIcon:sprite.UI_chase,rotation:!0,widthOnPic:40,heightOnPic:40,collisionDamage:10,width:40,height:40,defaultSpeed:9,HP:1,maxHP:1,animation:!1},betaStarPiece:{type:"betaStarPiece",behaviour:"collide",sprite:sprite.enemy_betaStarPiece,minimapIcon:sprite.UI_chase,rotation:!0,widthOnPic:40,heightOnPic:40,collisionDamage:15,width:50,height:50,defaultSpeed:10,HP:1,maxHP:1,animation:!1},corruptedCloud:{type:"corruptedCloud",behaviour:"chase",bulletType:"CLOUD",sprite:sprite.enemy_corruptedCloud,minimapIcon:sprite.UI_chase,rotation:!1,widthOnPic:120,heightOnPic:120,attackCDvalue:50,collisionDamage:20,width:120,height:120,defaultSpeed:25,HP:200,maxHP:200,animation:!0,animationFrames:4,animationFPS:6,deathAnimationFPS:8,deathAnimationFrames:4},carrier:{type:"carrier",behaviour:"ignore",bulletType:"UPLOADBASIC",turretBulletType:"CARRIERBASIC",sprite:sprite.enemy_carrier,turretSprite:sprite.enemy_carrierTurret,minimapIcon:sprite.UI_ignore,turrets:4,turretDist:[50,120,50,120],cache:["cube",3],turretAngle:[0,0,0,0],turretWidthOnPic:60,turretHeightOnPic:60,attackCDvalue:2500,collisionDamage:20,rotation:!0,widthOnPic:100,heightOnPic:200,width:150,height:300,defaultSpeed:1,HP:100,maxHP:100,animation:!1,deathAnimationFPS:8,deathAnimationFrames:5},betaCarrier:{type:"betaCarrier",behaviour:"ignore",bulletType:"BETAUPLOADBASIC",turretBulletType:"BETACARRIERBASIC",sprite:sprite.enemy_betaCarrier,turretSprite:sprite.enemy_betaCarrierTurret,minimapIcon:sprite.UI_ignore,turrets:4,turretDist:[50,120,50,120],cache:["betaCube",3],turretAngle:[0,0,0,0],turretWidthOnPic:60,turretHeightOnPic:60,attackCDvalue:2500,collisionDamage:20,rotation:!0,widthOnPic:100,heightOnPic:200,width:150,height:300,defaultSpeed:1,HP:150,maxHP:150,animation:!1,deathAnimationFPS:8,deathAnimationFrames:5},watcher:{type:"watcher",behaviour:"ignore",sprite:sprite.enemy_watcher,turretSprite:sprite.enemy_watcherTurret,minimapIcon:sprite.UI_ignore,rotation:!0,turrets:1,turretDist:[0],turretAngle:[0],turretWidthOnPic:40,turretHeightOnPic:40,widthOnPic:70,heightOnPic:70,attackCDvalue:2e3,turretBulletType:"WATCHERBASIC",bulletType:"UPLOADBASIC",collisionDamage:10,width:120,height:120,defaultSpeed:2,HP:50,maxHP:50,animation:!0,animationFrames:10,animationFPS:5,deathAnimationFPS:8,deathAnimationFrames:5},betaWatcher:{type:"betaWatcher",behaviour:"ignore",sprite:sprite.enemy_betaWatcher,turretSprite:sprite.enemy_betaWatcherTurret,minimapIcon:sprite.UI_ignore,rotation:!0,turrets:1,turretDist:[0],turretAngle:[0],turretWidthOnPic:40,turretHeightOnPic:40,widthOnPic:70,heightOnPic:70,attackCDvalue:2e3,turretBulletType:"BETAWATCHERBASIC",bulletType:"BETAUPLOADBASIC",collisionDamage:10,width:140,height:140,defaultSpeed:2,HP:70,maxHP:70,animation:!0,animationFrames:10,animationFPS:5,deathAnimationFPS:8,deathAnimationFrames:5},angela_phase1:{type:"angela_phase1",behaviour:"angela_phase1",bulletType:"ANGELABASIC",sprite:sprite.enemy_angelaPhase1,minimapIcon:sprite.UI_angela,ammo:100,weaponCD:!1,attackCDvalue:3e3,defaultAttackCDvalue:3e3,collisionDamage:20,rotation:!1,widthOnPic:216,heightOnPic:216,width:216,height:216,defaultSpeed:25,HP:500,maxHP:500,animation:!0,animationFrames:3,animationFPS:12,deathAnimationFPS:8,deathAnimationFrames:4},angela_phase2:{type:"angela_phase2",behaviour:"angela_phase2",bulletType:"ANGELABASIC",sprite:sprite.enemy_angelaPhase2,minimapIcon:sprite.UI_angela,ammo:100,weaponCD:!1,playerOrbitAngle:2*Math.PI,chargeActive:!1,chargePos:0,chargeEnd:!1,chargeXSpeed:0,chargeYSpeed:0,chargeSpeed:40,chargeWaitTime:2e3,chargeSound:!1,airStrikeActive:!1,airStrikeX:0,airStrikeY:0,airStrikeCD:750,airStrikeRadius:150,attackCDvalue:3e3,defaultAttackCDvalue:3e3,collisionDamage:35,moveWithPlayer:!0,distanceFromPlayerY:2,distanceFromPlayerX:2,rotation:!1,widthOnPic:216,heightOnPic:216,width:216,height:216,defaultSpeed:.01,HP:500,maxHP:500,animation:!0,animationFrames:3,animationFPS:12,deathAnimationFPS:8,deathAnimationFrames:4},angela_phase3:{type:"angela_phase3",behaviour:"angela_phase3",bulletType:"CORRUPTEDSHOT",sprite:sprite.enemy_angelaPhase3,minimapIcon:sprite.UI_angela,ammo:100,weaponCD:!1,playerOrbitAngle:2*Math.PI,chargeActive:!1,chargePos:0,chargeEnd:!1,chargeXSpeed:0,chargeYSpeed:0,chargeSpeed:35,chargeWaitTime:2e3,chargeSound:!1,airStrikeActive:!1,airStrikeX:0,airStrikeY:0,airStrikeCD:750,airStrikeRadius:200,playerPosReseted:!1,attackCDvalue:3e3,defaultAttackCDvalue:3e3,collisionDamage:40,moveWithPlayer:!0,distanceFromCenter:900,rotation:!1,widthOnPic:216,heightOnPic:216,width:216,height:216,defaultSpeed:.02,HP:500,maxHP:500,animation:!0,animationFrames:3,animationFPS:12,deathAnimationFPS:8,deathAnimationFrames:4}};var textIndex,dialogueList=[];class Dialogue{constructor(e,t,a,i=0,r=0){this.text=0==i?e.split(""):e,this.displayText=[""],this.stringIndex=i,this.ttl=a,this.timeToType=1,this.opacity=1,this.y=canvas.height/2+200*screenratio+40*r*screenratio,this.leadingRow=!0,this.color=t,this.part=r}update_render(){(!this.leadingRow||this.text.length<this.stringIndex)&&this.ttl--,this.ttl<50&&this.ttl>1&&this.opacity>0&&(this.opacity=Math.floor(100*(this.opacity-.02))/100),"#"==this.text[this.stringIndex]&&this.leadingRow?(this.leadingRow=!1,dialogueList.push(new Dialogue(this.text,this.color,this.ttl,this.stringIndex+1,++this.part))):this.leadingRow&&this.text.length>=this.stringIndex&&this.typingSequence(),"#adadad"==this.color?ctx.font=30*screenratio+"px Courier New":"cyan"==this.color?ctx.font=30*screenratio+"px Lucida Console":ctx.font=20*screenratio+"px FFFFORWA",ctx.textAlign="center",this.opacity<0?ctx.globalAlpha=0:ctx.globalAlpha=this.opacity,ctx.strokeStyle="black",ctx.strokeText(this.displayText.join(""),canvas.width/2,this.y),"#adadad"!=this.color&&"cyan"!=this.color||(this.color=1==Math.round(Math.random())?"#adadad":"cyan"),ctx.fillStyle=this.color,ctx.fillText(this.displayText.join(""),canvas.width/2,this.y)}typingSequence(){this.timeToType--,0==this.timeToType&&("white"==this.color?gameAudio.playSound("typing_angela"):"#adadad"==this.color||"cyan"==this.color?gameAudio.playSound("typing_angela_2"):"red"==this.color?gameAudio.playSound("typing_infernus"):("orange"==this.color&&environment.warningLong_activation(),gameAudio.playSound("typing_system")),this.displayText.push(this.text[this.stringIndex]),this.timeToType=5,this.stringIndex++)}}function pushDialogue(e){if(UI.inMenu)t=DialogueData.beforeTheBoss;else var t=DialogueData["level_"+playerData.level];textIndex=e,DialogueData.dialoguesUsed[e]=!0,dialogueList.push(new Dialogue(t.text[e],t.color[e],t.ttl[e]))}function dialogueHandler(){if(UI.inMenu)e=DialogueData.beforeTheBoss;else var e=DialogueData["level_"+playerData.level];for(let t=0;t<e.triggerType.length;t++)DialogueData.dialoguesUsed[t]||("timer"==e.triggerType[t]?e.triggerIndex[t]!=levelTimer||UI.inMenu?e.triggerIndex[t]==UI.beforeTheBossMenuTimer&&pushDialogue(t):pushDialogue(t):"enemyKilled"==e.triggerType[t]?e.triggerIndex[t]==levels_handler.level.total&&pushDialogue(t):"wave"==e.triggerType[t]?e.triggerIndex[t]==levels_handler.waveCounter&&pushDialogue(t):"after"==e.triggerType[t]&&0==dialogueList.length&&e.triggerIndex[t]==textIndex&&pushDialogue(t))}async function checkDeath(e,t="none"){if(e.HP<=0&&!e.deathAnimation&&!e.killed){if(e.deathAnimation=!0,gameAudio.playSound("enemy_death"),null!=e.cache)for(let t=0;t<e.cache[1];t++)enemyList.push(enemyCharacter(_objectSpread({randomDirCDcounter:120,x:e.x+Math.cos(2*Math.PI/e.cache[1])*(t+1)*20*(Math.random()>=.5?1:-1),y:e.y+Math.sin(2*Math.PI/e.cache[1])*(t+1)*20*(Math.random()>=.5?1:-1),randomDrop:!1,spawnCD:0},EnemyData[e.cache[0]]))),levels_handler.level.total+=1;if("SPREADER"==t&&bulletList.length<300){gameAudio.playSound("player_SPREADERPROJECTILE");for(let t=0;t<16;t++)bulletList.push(bullet(_objectSpread({x:e.x,y:e.y,dirx:Math.cos(Math.PI/8*t),diry:Math.sin(Math.PI/8*t)},WeaponData.SPREADERPROJECTILE),1))}if(null!=e.source&&e.source.spawns--,e.randomDrop){if(12!=playerData.level)var a=Math.round(8*Math.random())+1;else a=Math.round(7*Math.random())+1;for(let e in WeaponData)a==WeaponData[e].index&&(a=WeaponData[e].name);if(!player.inWeaponActivation){weaponActivation.targets=2+player.companions,gameAudio.playSound("player_getDrop"),weaponActivation.timerIndex=weaponActivation.defaultTimerIndex,weaponActivation.weaponName=a,player.inWeaponActivation=!0;for(let e=0;e<weaponActivation.targets;e++)spawnAnEnemy("lootCubeTarget")}}"loot"==e.behaviour?(lootCube.active=!1,lootCube.nextSpawn=levelTimer+1300):"lootCubeTarget"==e.behaviour?weaponActivation.targets--:1==levels_handler.level.total?(await sleep(2e3),1==levels_handler.level.total&&(levels_handler.level.total-=1)):levels_handler.level.total-=1}}_defineProperty(Dialogue,"stopDialogues",!1);var enemyBulletList=[];function enemyBullet(e,t="none",a=0,i=0,r=!0){return e.x>-200&&e.x<canvas.width+200&&e.y>-200&&e.y<canvas.height+200&&r&&gameAudio.playSound(e.sound),e.target=t,e.killed=!1,e.opacity=1,e.animationIndex=0,e.animationX=0,null==e.width&&null==e.height&&(e.width=e.widthOnPic*screenratio,e.height=e.heightOnPic*screenratio),e.angle=0,"none"==t?(e.dirx=player.earthX-e.x,e.diry=player.earthY-e.y):"custom"==t?(e.dirx=a-e.x,e.diry=i-e.y):(e.dirx=t.x+20*t.xspeed-e.x,e.diry=t.y+20*t.yspeed-e.y),e.angle=Math.atan2(e.diry,e.dirx)+Math.PI/2,e.hitBoxWidth=e.width/3*2,e.hitBoxHeight=e.height/3*2,e.update=function(){e.rotationAnimation&&(e.angle+=e.rotationSpeed/180*Math.PI,e.angle>2*Math.PI&&(e.angle=0)),e.animation&&(e.animationIndex++,e.animationIndex%e.animationUpdate==0&&(e.animationIndex=0,e.animationX++),e.animationX==e.animationFrames&&(e.animationX=0));let t=e.speed/(Math.abs(e.dirx)+Math.abs(e.diry));e.xspeed=t*e.dirx,e.yspeed=t*e.diry,e.x+=e.xspeed-player.xspeed-camera.offSetX,e.y+=e.yspeed-player.yspeed-camera.offSetY,e.hitBoxX=e.x-e.hitBoxWidth/2,e.hitBoxY=e.y-e.hitBoxHeight/2,e.calcTTL()},e.render=function(){ctx.save(),ctx.translate(e.x,e.y),ctx.rotate(e.angle),ctx.globalAlpha=e.opacity,ctx.drawImage(e.sprite,0+e.widthOnPic*e.animationX,0,e.widthOnPic,e.heightOnPic,-e.width/2,-e.height/2,e.width,e.height),ctx.restore()},e.calcTTL=function(){e.ttl>0?e.ttl-=1:e.killed=!0},e}var enemyList=[];function enemyCharacter(e){e.appearOpacity=0,e.appear=async function(){for(let t=1;t<=100;t++)e.appearOpacity=t/100,await sleep(10)},e.aggressiveAppear=async function(){for(let t=1;t<=100;t++)e.appearOpacity=t/100,await sleep(1)},e.width*=screenratio,e.height*=screenratio,e.manualUpdate=!1,e.defaultSpeed*=screenratio,e.coordX=player.defaultSpaceSize/2+e.x-player.earthX,e.coordY=player.defaultSpaceSize/2+e.y-player.earthY,e.speed=e.defaultSpeed,e.deathAnimation=!1,e.deathAnimation_angle=2*Math.random()*Math.PI,e.deathAnimation_index=0,e.deathAnimation_countdown=0,e.killed=!1,e.animationX=0,e.animationY=0,e.animationIndex=0,e.arrival=!1,e.acceleration=100,e.target="none",e.orbitAngle=Math.atan2(player.earthX-e.y,player.earthY-e.x)+Math.PI/2,e.angle=Math.atan2(player.earthY-e.y,player.earthX-e.x)+Math.PI/2,e.turrets>0&&(e.turretAttackCD=[!1,!1,!1,!1]),null==e.hitBoxWidth&&(e.hitBoxWidth=e.width/3*2,e.hitBoxHeight=e.height/3*2,e.hitBoxX=e.x-e.hitBoxWidth/2,e.hitBoxY=e.y-e.hitBoxHeight/2),e.update=function(){if(e.checkBehaviour(),!e.manualUpdate){if((Math.abs(e.x-player.earthX)>player.spaceSize/2||Math.abs(e.y-player.earthY)>player.spaceSize/2)&&!e.moveWithPlayer){e.randomDirCDCounter=300,e.randomDirX=Math.cos(2*Math.random()*Math.PI),e.randomDirY=Math.sin(2*Math.random()*Math.PI);let t=e.speed/(Math.abs(player.earthX-e.x)+Math.abs(player.earthY-e.y));e.xspeed=t*(player.earthX-e.x),e.yspeed=t*(player.earthY-e.y)}else if("ignore"==e.behaviour){let t=e.speed/(Math.abs(player.earthX-e.x)+Math.abs(player.earthY-e.y));e.xspeed=t*(player.earthX-e.x),e.yspeed=t*(player.earthY-e.y)}else if("orbit"==e.behaviour)if(e.inOrbit)e.orbitAngle-=.01,e.xspeed=e.speed*Math.cos(e.orbitAngle),e.yspeed=e.speed*Math.sin(e.orbitAngle);else{let t=e.speed/(Math.abs(player.earthX-e.x)+Math.abs(player.earthY-e.y));e.xspeed=t*(player.earthX-e.x),e.yspeed=t*(player.earthY-e.y)}else if("spawn"==e.behaviour||"loot"==e.behaviour||"none"==e.target&&"chase"==e.behaviour){e.randomDirCD(),e.angle=Math.atan2(e.randomDirY,e.randomDirX)+Math.PI/2;let t=e.speed/(Math.abs(e.randomDirX)+Math.abs(e.randomDirY));e.xspeed=t*e.randomDirX,e.yspeed=t*e.randomDirY}else if(e.moveWithPlayer)"angela_phase3"==e.behaviour?(e.playerOrbitAngle-=e.speed,e.x=e.distanceFromCenter*Math.cos(e.playerOrbitAngle)*screenratio+player.earthX,e.y=e.distanceFromCenter*Math.sin(e.playerOrbitAngle)*screenratio+player.earthY,e.coordX=player.defaultSpaceSize/2+e.x-player.earthX,e.coordY=player.defaultSpaceSize/2+e.y-player.earthY,e.playerOrbitAngle<=0&&(e.playerOrbitAngle=2*Math.PI)):(e.playerOrbitAngle-=e.speed,e.x=canvas.width/e.distanceFromPlayerX*Math.cos(e.playerOrbitAngle)+player.x,e.y=canvas.height/e.distanceFromPlayerY*Math.sin(e.playerOrbitAngle)+player.y,e.coordX=player.defaultSpaceSize/2+e.x-player.earthX,e.coordY=player.defaultSpaceSize/2+e.y-player.earthY,e.playerOrbitAngle<=0&&(e.playerOrbitAngle=2*Math.PI));else{e.randomDirCDcounter=300;let t=e.speed/(Math.abs(e.target.x-e.x)+Math.abs(e.target.y-e.y));e.xspeed=t*(e.target.x-e.x)*e.acceleration/100,e.yspeed=t*(e.target.y-e.y)*e.acceleration/100}e.moveWithPlayer||(e.x+=e.xspeed-player.xspeed-camera.offSetX,e.y+=e.yspeed-player.yspeed-camera.offSetY,e.coordX+=e.xspeed,e.coordY+=e.yspeed)}e.hitBoxWidth=Math.abs(e.width/3*2*Math.pow(Math.cos(e.angle),2)+e.height/3*2*Math.pow(Math.sin(e.angle),2)),e.hitBoxHeight=Math.abs(e.width/3*2*Math.pow(Math.sin(e.angle),2)+e.height/3*2*Math.pow(Math.cos(e.angle),2)),e.hitBoxX=e.x-e.hitBoxWidth/2,e.hitBoxY=e.y-e.hitBoxHeight/2,null!=e.ttl&&e.calcTTL()},e.render=function(){if(e.animation&&!e.spawning&&(e.animationIndex+=1,e.animationIndex==60/e.animationFPS&&(e.animationIndex=0,e.animationX<e.widthOnPic*(e.animationFrames-1)?e.animationX+=e.widthOnPic:e.animationX=0)),ctx.save(),ctx.translate(e.x,e.y),!e.inOrbit&&e.rotation?ctx.rotate(e.angle):e.rotation&&ctx.rotate(Math.atan2(player.earthY-e.y,player.earthX-e.x)-Math.PI),ctx.globalAlpha=e.appearOpacity,ctx.drawImage(e.sprite,0+e.animationX,0,e.widthOnPic,e.heightOnPic,-e.width/2,-e.height/2,e.width,e.height),e.opacity>0&&(ctx.globalAlpha=e.opacity,ctx.drawImage(e.sprite,0+e.animationX,e.heightOnPic,e.widthOnPic,e.heightOnPic,-e.width/2,-e.height/2,e.width,e.height)),ctx.restore(),e.turrets>0)for(let t=0;t<e.turrets;t++)ctx.save(),ctx.translate(e.x+e.turretDist[t]*Math.cos(e.angle+Math.PI/2*t)*screenratio,e.y+e.turretDist[t]*Math.sin(e.angle+Math.PI/2*t)*screenratio),ctx.rotate(e.turretAngle[t]),ctx.globalAlpha=e.appearOpacity,ctx.drawImage(e.turretSprite,0,0,e.turretWidthOnPic,e.turretHeightOnPic,-e.turretWidthOnPic/2,-e.turretHeightOnPic/2,e.turretWidthOnPic,e.turretHeightOnPic),ctx.globalAlpha=e.opacity,ctx.drawImage(e.turretSprite,0,e.turretHeightOnPic,e.turretWidthOnPic,e.turretHeightOnPic,-e.turretWidthOnPic/2,-e.turretHeightOnPic/2,e.turretWidthOnPic,e.turretHeightOnPic),ctx.restore();ctx.globalAlpha=.8,ctx.fillStyle="#606060",ctx.fillRect(e.x-15,e.y+e.height/2,e.height/3>30?e.height/3:30,5),ctx.fillStyle="white",ctx.fillRect(e.x-15,e.y+e.height/2,e.HP/e.maxHP*(e.height/3>30?e.height/3:30),5),ctx.strokeStyle="#000000",ctx.globalAlpha=1,ctx.lineWidth=1,ctx.strokeRect(e.x-15,e.y+e.height/2,e.height/3>30?e.height/3:30,5)},e.deathAnimation_render=function(){e.x+=-player.xspeed-camera.offSetX,e.y+=-player.yspeed-camera.offSetY,e.killed||(e.deathAnimation_countdown+=1,e.deathAnimation_countdown%e.deathAnimationFPS==0&&(e.deathAnimation_angle=2*Math.random()*Math.PI,e.deathAnimation_index+=1),ctx.save(),ctx.translate(e.x,e.y),"smallCube"==e.type||"largeCube"==e.type?ctx.rotate(e.deathAnimation_angle):ctx.rotate(e.angle),ctx.drawImage(e.sprite,e.widthOnPic*e.deathAnimation_index,2*e.heightOnPic,e.widthOnPic,e.heightOnPic,-e.width/2,-e.height/2,e.width,e.height),ctx.restore(),e.deathAnimation_index==e.deathAnimationFrames&&(e.killed=!0,e.deathAnimation=!1))},e.attackCD=!1,e.piercingCD=!1,e.opacity=0,e.chaseBehaviour=async function(){if(e.playerDistance=Math.sqrt(Math.pow(player.x-e.x,2)+Math.pow(player.y-e.y,2)),e.playerDistance<800*screenratio&&"none"==e.target&&player.HP[1]>0&&(e.target=player),"none"!=e.target)if(e.angle=Math.atan2(e.target.y-e.y,e.target.x-e.x)+Math.PI/2,e.playerDistance>900*screenratio||e.target.HP[1]<=0)e.acceleration<=99?e.acceleration+=1:e.acceleration=100,e.randomDirX=e.target.x-e.x,e.randomDirY=e.target.y-e.y,e.target="none",e.speed=e.defaultSpeed,e.randomDirCDcounter=120;else if(e.playerDistance<650*screenratio)if(e.acceleration>=1?e.acceleration-=1:e.acceleration=0,e.attackCD||null!=e.bullets){if(!e.attackCD){e.attackCDstart();for(let t=0;t<e.bullets;t++)enemyBulletList.push(enemyBullet(_objectSpread({x:e.x,y:e.y},enemyWeaponData[e.bulletType]),player)),await sleep(e.bulletDelay)}}else e.attackCDstart(),enemyBulletList.push(enemyBullet(_objectSpread({x:e.x,y:e.y},enemyWeaponData[e.bulletType]),player));else e.acceleration<=99?e.acceleration+=1:e.acceleration=100,e.speed=e.defaultSpeed;else e.acceleration<=99?e.acceleration+=1:e.acceleration=100},e.ignoreBehaviour=function(){if(e.distance=Math.sqrt(Math.pow(player.earthX-e.x,2)+Math.pow(player.earthY-e.y,2)),e.distance<240*screenratio&&!e.arrival?(e.speed=0,e.arrival=!0,e.attackCDstart()):e.arrival&&!e.attackCD&&(e.attackCDstart(),enemyBulletList.push(enemyBullet(_objectSpread({x:e.x,y:e.y},enemyWeaponData[e.bulletType])))),e.turrets>0)for(let t=e.turrets-1;t>=0;t--){let a=e.x+e.turretDist[t]*Math.cos(e.angle+Math.PI/2*t)*screenratio,i=e.y+e.turretDist[t]*Math.sin(e.angle+Math.PI/2*t)*screenratio;Math.sqrt(Math.pow(player.x-a,2)+Math.pow(player.y-i,2))<850*screenratio?(e.turretAngle[t]=Math.atan2(player.y-e.y,player.x-e.x)+Math.PI/2,e.turretAttackCD[t]||(e.turretAttackCDstart(t),enemyBulletList.push(enemyBullet(_objectSpread({x:a,y:i},enemyWeaponData[e.turretBulletType]),player)))):e.turretAngle[t]=e.angle}},e.spawnBehaviour=function(){e.spawning&&e.spawnSummonTick(),"mail"!=e.type&&"betaMail"!=e.type?e.spawnDistance=Math.sqrt(Math.pow(player.x-e.x,2)+Math.pow(player.y-e.y,2)):e.spawnDistance=0,e.spawnDistance<450*screenratio&&!e.spawning&&!e.attackCD&&e.spawns<e.maximumSpawns?(e.spawning=!0,"mail"!=e.type&&"betaMail"!=e.type||(e.speed=0),e.attackCDstart()):e.speed=e.defaultSpeed},e.spawnSummonTick=function(){if("mail"==e.type||"betaMail"==e.type)e.spawnAnimationIndex+=1,e.spawnAnimationIndex==60/e.spawnAnimationFPS&&(e.spawnAnimationIndex=0,e.animationX<e.widthOnPic*(e.spawnAnimationFrames-1)?e.animationX+=e.widthOnPic:(e.spawning=!1,enemyList.push(enemyCharacter(_objectSpread({randomDirCDcounter:120,source:e,x:e.x+50*(Math.random()-.5),y:e.y+50*(Math.random()-.5),randomDrop:!1,spawnCD:0},EnemyData[e.bulletType]))),"betaMail"==e.type&&(enemyList.push(enemyCharacter(_objectSpread({randomDirCDcounter:120,source:e,x:e.x+50*(Math.random()-.5),y:e.y+50*(Math.random()-.5),randomDrop:!1,spawnCD:0},EnemyData[e.bulletType]))),e.spawns++,levels_handler.level.total+=1),e.spawns++,levels_handler.level.total+=1,e.animationX=0));else if("star"==e.type||"betaStar"==e.type){for(let t=0;t<7&&e.spawns<e.maximumSpawns;t++){let a=Math.PI/4*t;enemyList.push(enemyCharacter(_objectSpread({randomDirCDcounter:120,ttl:600,source:e,x:e.x+100*Math.cos(a)*screenratio,y:e.y+100*Math.sin(a)*screenratio,randomDrop:!1,spawnCD:0},EnemyData[e.bulletType]))),e.spawns++,levels_handler.level.total+=1}e.spawning=!1}},e.collideBehaviour=function(){e.target=player,e.angle=Math.atan2(e.target.y-e.y,e.target.x-e.x)+Math.PI/2},e.orbitBehaviour=function(){e.distance=Math.sqrt(Math.pow(player.earthX-e.x,2)+Math.pow(player.earthY-e.y,2)),e.distance<500*screenratio&&!e.inOrbit?(e.inOrbit=!0,e.arrival=!0,e.attackCDstart()):e.inOrbit&&!e.attackCD&&(e.attackCDstart(),enemyBulletList.push(enemyBullet(_objectSpread({x:e.x,y:e.y},enemyWeaponData[e.bulletType]))))},e.mineBehaviour=function(){e.distance=Math.sqrt(Math.pow(player.earthX-e.x,2)+Math.pow(player.earthY-e.y,2)),e.distance<40*screenratio&&e.HP>0&&(e.HP=0,player.shield[0]>=2?player.shield[0]-=2:1==player.shield[0]?(player.shield[0]-=1,player.HP[0]-=1):player.HP[0]-=2,checkDeath(e))},e.angelaBehaviour1=function(){e.target=player,e.angle=Math.atan2(e.target.y-e.y,e.target.x-e.x)+Math.PI/2,e.playerDistance=Math.sqrt(Math.pow(player.x-e.x,2)+Math.pow(player.y-e.y,2));let t=1-e.HP/e.maxHP;if(e.attackCDvalue=e.defaultAttackCDvalue-1200*t,e.playerDistance<650*screenratio)if(e.acceleration>=1?e.acceleration-=1:e.acceleration=0,e.ammo>0&&!e.attackCD)if("COG"!=e.bulletType||e.weaponCD)if("ANGELABASIC"!=e.bulletType||e.weaponCD){if("CORRUPTEDSHOT"==e.bulletType&&!e.weaponCD){for(let a=0;a<16;a++){let i=Math.round(Math.random());enemyBulletList.push(enemyBullet(_objectSpread({x:e.x,y:e.y},enemyWeaponData[e.bulletType]),"custom",e.x+Math.cos(Math.PI/8*a+Math.PI/16*i),e.y+Math.sin(Math.PI/8*a+Math.PI/16*i))),e.ammo-=4-Math.round(1*t)}setTimer(200-30*t,e,"weaponCD")}}else{for(let a=-4;a<4;a++)enemyBulletList.push(enemyBullet(_objectSpread({x:e.x,y:e.y},enemyWeaponData[e.bulletType]),"custom",e.x+Math.cos(e.angle-Math.PI/2+.06*a),e.y+Math.sin(e.angle-Math.PI/2+.06*a),!1)),e.ammo-=4-Math.round(1*t),a%2==0&&gameAudio.playSound("enemy_BASIC");setTimer(300-30*t,e,"weaponCD")}else{let a=.5*Math.random();for(let i=0;i<12;i++)enemyBulletList.push(enemyBullet(_objectSpread({x:e.x,y:e.y},enemyWeaponData[e.bulletType]),"custom",e.x+Math.cos((Math.PI/6+a)*i),e.y+Math.sin((Math.PI/6+a)*i))),e.ammo-=2-Math.round(1*t);setTimer(200-30*t,e,"weaponCD")}else e.attackCD||(e.attackCDstart(),e.ammo=100,"COG"==e.bulletType?e.bulletType="ANGELABASIC":"ANGELABASIC"==e.bulletType?e.bulletType="CORRUPTEDSHOT":"CORRUPTEDSHOT"==e.bulletType&&(e.bulletType="COG"));else e.acceleration<=99?e.acceleration+=1:e.acceleration=100,e.speed=e.defaultSpeed},e.angelaBehaviour2=function(){e.target=player,e.angle=Math.atan2(e.target.y-e.y,e.target.x-e.x)+Math.PI/2;let t=1-e.HP/e.maxHP;if(e.attackCDvalue=e.defaultAttackCDvalue-1500*t,e.ammo>0&&!e.attackCD)if("COG"!=e.bulletType||e.weaponCD)if("ANGELABASIC"!=e.bulletType||e.weaponCD)if("CORRUPTEDSHOT"!=e.bulletType||e.weaponCD)"CHARGE"==e.bulletType?e.chargeActive?!e.weaponCD&&e.chargeActive?(e.chargeSound&&(gameAudio.playSound("enemy_CHARGE"),e.chargeSound=!1),e.x+=e.chargeXSpeed-player.xspeed-camera.offSetX,e.y+=e.chargeYSpeed-player.yspeed-camera.offSetY,e.coordX+=e.chargeXSpeed,e.coordY+=e.chargeYSpeed,e.chargeEnd||(e.ammo-=100-1*Math.round(t),e.manualUpdate=!1,e.chargeActive=!1,e.appearOpacity=0,e.aggressiveAppear())):(0==e.chargeSet?(e.x=canvas.width,e.y=player.y,e.chargeXSpeed=-e.chargeSpeed*screenratio,e.chargeYSpeed=0):1==e.chargeSet?(e.x=0,e.y=player.y,e.chargeXSpeed=e.chargeSpeed*screenratio,e.chargeYSpeed=0):2==e.chargeSet?(e.x=player.x,e.y=canvas.height,e.chargeXSpeed=0,e.chargeYSpeed=-e.chargeSpeed*screenratio):3==e.chargeSet&&(e.x=player.x,e.y=0,e.chargeXSpeed=0,e.chargeYSpeed=e.chargeSpeed*screenratio),e.coordX=player.spaceSize/2+e.x-player.earthX,e.coordY=player.spaceSize/2+e.y-player.earthY,e.chargeRectX-=camera.offSetX,e.chargeRectY-=camera.offSetY,ctx.globalAlpha=.3,ctx.fillStyle="red",e.chargeSet<=1?(ctx.fillRect(0,e.chargeRectY-e.height/2,canvas.width,e.height),ctx.globalAlpha=.6,ctx.drawImage(sprite.projectile_enemyDANGER,0,0,102,102,canvas.width/3-51*screenratio,e.chargeRectY-51*screenratio,102*screenratio,102*screenratio),ctx.drawImage(sprite.projectile_enemyDANGER,0,0,102,102,2*canvas.width/3-51*screenratio,e.chargeRectY-51*screenratio,102*screenratio,102*screenratio)):(ctx.fillRect(e.chargeRectX-e.width/2,0,e.width,canvas.height),ctx.globalAlpha=.6,ctx.drawImage(sprite.projectile_enemyDANGER,0,0,102,102,e.chargeRectX-51*screenratio,canvas.height/3-51*screenratio,102*screenratio,102*screenratio),ctx.drawImage(sprite.projectile_enemyDANGER,0,0,102,102,e.chargeRectX-51*screenratio,2*canvas.height/3-51*screenratio,102*screenratio,102*screenratio))):(e.chargeSet=Math.round(3*Math.random()),e.appearOpacity=0,e.aggressiveAppear(),e.chargeActive=!0,e.manualUpdate=!0,e.chargeSound=!0,e.chargeRectX=player.x,e.chargeRectY=player.y,setTimer(e.chargeWaitTime-500*t,e,"weaponCD"),setTimer(1e3+e.chargeWaitTime-500*t,e,"chargeEnd")):"AIRSTRIKE"==e.bulletType&&(e.airStrikeActive?!e.weaponCD&&e.airStrikeActive?(enemyBulletList.push(enemyBullet(_objectSpread({x:e.airStrikeX,y:e.airStrikeY,width:e.airStrikeRadius*screenratio,height:e.airStrikeRadius*screenratio},enemyWeaponData[e.bulletType]),"custom",e.airStrikeX+.01,e.airStrikeY+.01)),e.ammo-=15,e.airStrikeActive=!1):(e.airStrikeX+=-player.xspeed-camera.offSetX,e.airStrikeY+=-player.yspeed-camera.offSetY,ctx.globalAlpha=1,ctx.fillStyle="red",ctx.drawImage(sprite.projectile_enemyAIRSTRIKEDANGER,0,0,150,150,e.airStrikeX-e.airStrikeRadius/2*screenratio,e.airStrikeY-e.airStrikeRadius/2*screenratio,e.airStrikeRadius*screenratio,e.airStrikeRadius*screenratio)):(setTimer(e.airStrikeCD-200*t,e,"weaponCD"),e.airStrikeX=player.x,e.airStrikeY=player.y,e.airStrikeActive=!0));else{for(let t=0;t<16;t++){let a=Math.round(Math.random());enemyBulletList.push(enemyBullet(_objectSpread({x:e.x,y:e.y},enemyWeaponData[e.bulletType]),"custom",e.x+Math.cos(Math.PI/8*t+Math.PI/16*a),e.y+Math.sin(Math.PI/8*t+Math.PI/16*a))),e.ammo-=4}setTimer(200-40*t,e,"weaponCD")}else{for(let t=-4;t<4;t++)enemyBulletList.push(enemyBullet(_objectSpread({x:e.x,y:e.y},enemyWeaponData[e.bulletType]),"custom",e.x+Math.cos(e.angle-Math.PI/2+.06*t),e.y+Math.sin(e.angle-Math.PI/2+.06*t))),e.ammo-=4;setTimer(300-40*t,e,"weaponCD")}else{let a=.5*Math.random();for(let t=0;t<12;t++)enemyBulletList.push(enemyBullet(_objectSpread({x:e.x,y:e.y},enemyWeaponData[e.bulletType]),"custom",e.x+Math.cos((Math.PI/6+a)*t),e.y+Math.sin((Math.PI/6+a)*t))),e.ammo-=2;setTimer(200-40*t,e,"weaponCD")}else e.attackCD||(e.attackCDstart(),e.ammo=100,"ANGELABASIC"==e.bulletType?e.bulletType="CHARGE":"CHARGE"==e.bulletType?e.bulletType="COG":"COG"==e.bulletType?e.bulletType="AIRSTRIKE":"AIRSTRIKE"==e.bulletType&&(e.bulletType="ANGELABASIC"))},e.angelaBehaviour3=function(){e.target=player,e.angle=Math.atan2(e.target.y-e.y,e.target.x-e.x)+Math.PI/2;let t=1-e.HP/e.maxHP;if(e.attackCDvalue=e.defaultAttackCDvalue-2e3*t,e.playerPosReseted||(e.attackCDstart(),e.playerPosReseted=!0,player.setPos(0,0),background.inicialize(),backgroundParticles.inicialize(),camera.inicialize(),player.spaceSize=1200*screenratio),e.ammo>0&&!e.attackCD)if("CORRUPTEDSHOT"!=e.bulletType||e.weaponCD){if("CHARGE"==e.bulletType)e.chargeActive?!e.weaponCD&&e.chargeActive?(e.chargeSound&&(gameAudio.playSound("enemy_CHARGE"),e.chargeSound=!1),e.x+=e.chargeXSpeed-player.xspeed-camera.offSetX,e.y+=e.chargeYSpeed-player.yspeed-camera.offSetY,e.coordX+=e.chargeXSpeed,e.coordY+=e.chargeYSpeed,e.chargeEnd||(e.ammo-=100-Math.floor(66*t),e.manualUpdate=!1,e.chargeActive=!1,e.appearOpacity=0,e.aggressiveAppear())):(0==e.chargeSet?(e.x=canvas.width,e.y=player.y,e.chargeXSpeed=-e.chargeSpeed*screenratio,e.chargeYSpeed=0):1==e.chargeSet?(e.x=0,e.y=player.y,e.chargeXSpeed=e.chargeSpeed*screenratio,e.chargeYSpeed=0):2==e.chargeSet?(e.x=player.x,e.y=canvas.height,e.chargeXSpeed=0,e.chargeYSpeed=-e.chargeSpeed*screenratio):3==e.chargeSet&&(e.x=player.x,e.y=0,e.chargeXSpeed=0,e.chargeYSpeed=e.chargeSpeed*screenratio),e.coordX=player.spaceSize/2+e.x-player.earthX,e.coordY=player.spaceSize/2+e.y-player.earthY,e.chargeRectX-=camera.offSetX,e.chargeRectY-=camera.offSetY,ctx.globalAlpha=.3,ctx.fillStyle="red",e.chargeSet<=1?(ctx.fillRect(0,e.chargeRectY-e.height/2,canvas.width,e.height),ctx.globalAlpha=.6,ctx.drawImage(sprite.projectile_enemyDANGER,0,0,102,102,canvas.width/3-51*screenratio,e.chargeRectY-51*screenratio,102*screenratio,102*screenratio),ctx.drawImage(sprite.projectile_enemyDANGER,0,0,102,102,2*canvas.width/3-51*screenratio,e.chargeRectY-51*screenratio,102*screenratio,102*screenratio)):(ctx.fillRect(e.chargeRectX-e.width/2,0,e.width,canvas.height),ctx.globalAlpha=.6,ctx.drawImage(sprite.projectile_enemyDANGER,0,0,102,102,e.chargeRectX-51*screenratio,canvas.height/3-51*screenratio,102*screenratio,102*screenratio),ctx.drawImage(sprite.projectile_enemyDANGER,0,0,102,102,e.chargeRectX-51*screenratio,2*canvas.height/3-51*screenratio,102*screenratio,102*screenratio))):(e.chargeSet=Math.round(3*Math.random()),e.appearOpacity=0,e.aggressiveAppear(),e.chargeActive=!0,e.manualUpdate=!0,e.chargeSound=!0,e.chargeRectX=player.x,e.chargeRectY=player.y,setTimer(e.chargeWaitTime-900*t,e,"weaponCD"),setTimer(1e3+e.chargeWaitTime-900*t,e,"chargeEnd"));else if("AIRSTRIKE"==e.bulletType)if(e.airStrikeActive)!e.weaponCD&&e.airStrikeActive?(enemyBulletList.push(enemyBullet(_objectSpread({x:e.airStrikeX,y:e.airStrikeY,width:e.airStrikeRadius*screenratio,height:e.airStrikeRadius*screenratio},enemyWeaponData[e.bulletType]),"custom",e.airStrikeX+.01,e.airStrikeY+.01)),e.ammo-=15,e.airStrikeActive=!1):(e.airStrikeX+=-player.xspeed-camera.offSetX,e.airStrikeY+=-player.yspeed-camera.offSetY,ctx.globalAlpha=.6,ctx.fillStyle="red",ctx.drawImage(sprite.projectile_enemyAIRSTRIKEDANGER,0,0,150,150,e.airStrikeX-e.airStrikeRadius/2*screenratio,e.airStrikeY-e.airStrikeRadius/2*screenratio,e.airStrikeRadius*screenratio,e.airStrikeRadius*screenratio));else{if(setTimer(e.airStrikeCD-200*t,e,"weaponCD"),t>.5){let t=.5*Math.random();for(let a=0;a<12;a++)enemyBulletList.push(enemyBullet(_objectSpread({x:e.x,y:e.y},enemyWeaponData.COG),"custom",e.x+Math.cos((Math.PI/6+t)*a),e.y+Math.sin((Math.PI/6+t)*a)))}e.airStrikeX=player.x,e.airStrikeY=player.y,e.airStrikeActive=!0}}else{for(let a=0;a<16;a++){let i=Math.round(Math.random());enemyBulletList.push(enemyBullet(_objectSpread({x:e.x,y:e.y},enemyWeaponData[e.bulletType]),"custom",e.x+Math.cos(Math.PI/8*a+Math.PI/16*i),e.y+Math.sin(Math.PI/8*a+Math.PI/16*i))),e.ammo-=4-Math.round(2*t)}if(t>.5)for(let t=-3;t<3;t++)enemyBulletList.push(enemyBullet(_objectSpread({x:e.x,y:e.y},enemyWeaponData.ANGELABASIC),"custom",e.x+Math.cos(e.angle-Math.PI/2+.1*t),e.y+Math.sin(e.angle-Math.PI/2+.1*t)));setTimer(200-30*t,e,"weaponCD")}else e.attackCD||(e.attackCDstart(),e.ammo=100,"CORRUPTEDSHOT"==e.bulletType?e.bulletType="AIRSTRIKE":"AIRSTRIKE"==e.bulletType?e.bulletType="CHARGE":"CHARGE"==e.bulletType&&(e.bulletType="CORRUPTEDSHOT"))},e.lootCubeTarget=function(){weaponActivation.targets<0&&(e.HP=0,checkDeath(e))},e.checkBehaviour=function(){switch(e.behaviour){case"chase":e.chaseBehaviour();break;case"ignore":e.ignoreBehaviour();break;case"spawn":e.spawnBehaviour();break;case"collide":e.collideBehaviour();break;case"angela_phase1":e.angelaBehaviour1();break;case"angela_phase2":e.angelaBehaviour2();break;case"angela_phase3":e.angelaBehaviour3();break;case"lootCubeTarget":e.lootCubeTarget();break;case"mine":e.mineBehaviour();break;case"orbit":e.orbitBehaviour()}},e.attackCDstart=async function(){e.attackCD=!0,await sleep(e.attackCDvalue),e.attackCD=!1},e.turretAttackCDstart=async function(t){e.turretAttackCD[t]=!0,await sleep(e.attackCDvalue),e.turretAttackCD[t]=!1};for(let t=0;t<e.turrets;t++)e.turretAttackCDstart(t);return playerData.level<12&&e.attackCDstart(),e.hitCDstart=async function(){e.opacity=.71;for(let t=70;t>=0&&e.opacity==(t+1)/100;t--)e.opacity=t/100,await sleep(10)},e.piercingDamageCDstart=async function(t){e.piercingCD=!0,await sleep(t),e.piercingCD=!1},e.randomDirCDcounter=1,e.randomDirCD=function(){e.randomDirCDcounter-=1,0===e.randomDirCDcounter&&(e.randomDirCDcounter=300,e.randomDirX=Math.cos(2*Math.random()*Math.PI),e.randomDirY=Math.sin(2*Math.random()*Math.PI))},e.calcTTL=function(){e.ttl>0?e.ttl-=1:(e.HP=0,checkDeath(e))},0==e.appearOpacity&&e.appear(),e}var xMousePos,yMousePos,damageNumberList=[];class DamageNumber{constructor(e,t,a){this.text=e,this.x=t+Math.floor(20*Math.random()*(Math.random()>.5?1:-1)),this.y=a+Math.floor(20*Math.random()*(Math.random()>.5?1:-1)),this.ttl=60}update_render(){this.x+=1,this.y-=1,this.x+=-(player.xspeed+camera.offSetX),this.y+=-(player.yspeed+camera.offSetY),this.ttl--,ctx.fillStyle="#8C95FF",ctx.globalAlpha=.6,ctx.font=20*screenratio+"px FFFFORWA",ctx.fillText(this.text,this.x,this.y),ctx.lineWidth=2,ctx.strokeStyle="black",ctx.strokeText(this.text,this.x,this.y)}}var leftMouseDown=!1,rightMouseDown=!1;async function userInput(e,t){0==t?(xMousePos=Math.abs(e.clientX),yMousePos=Math.abs(e.clientY)):1==t?1==e.which?leftMouseDown=!0:3==e.which?rightMouseDown=!0:27!=e.which||UI.inMenu?keyboardControler.active&&keyboardControler.eventHandler(e.key.toUpperCase(),"down"):(gameAudio.gameAudioFiles.player_LASER_loop.paused||(gameAudio.player_LASER_loop.pause(),player.LASER_firing=!1),gameAudio.stopMusic(),getMenu(4)):2==t&&(1==e.which?leftMouseDown=!1:3==e.which?rightMouseDown=!1:122==e.which?document.fullscreenElement?document.exitFullscreen():canvas.requestFullscreen().catch(e=>{console.log(e)}):keyboardControler.active&&keyboardControler.eventHandler(e.key.toUpperCase(),"up"))}document.onfullscreenchange=function(){scale(),UI.inMenu&&player.inicialize(0,50),background.inicialize(),backgroundParticles.inicialize(),environment.inicialize(),UI.inicialize()};var keyboardControler={buttonsActive:0,inicialize:function(){this.active=playerData.keyboardControl,this.movementVectorX=canvas.width/2,this.movementVectorY=canvas.height/2,this.W={x:0,y:-1,active:!1},this.A={x:-1,y:0,active:!1},this.S={x:0,y:1,active:!1},this.D={x:1,y:0,active:!1}},eventHandler:function(e,t){let a=this[e];try{"down"!=t||a.active?"up"==t&&a.active&&(a.active=!1,this.buttonsActive--,this.movementVectorX-=a.x,this.movementVectorY-=a.y,player.ratioByKeyboard(this.movementVectorX,this.movementVectorY,!0)):(this.buttonsActive++,a.active=!0,this.movementVectorX+=a.x,this.movementVectorY+=a.y,player.ratioByKeyboard(this.movementVectorX,this.movementVectorY,!0))}catch(e){}}};function checkRefreshRate(){let e=0,t=Date.now(),a=t-e;return a>1e3/60&&(e=t-a%(1e3/60),!0)}var levelTimer=0;function gameLoop(){if(ctx.globalAlpha=1,UI.inMenu){ctx.clearRect(0,0,canvas.width,canvas.height),UI.currentMenu<4&&background.update_render(),5==UI.currentMenu&&(dialogueHandler(),dialogueList.length>0?(gameAudio.changeVolumeOfMusic(.01),(dialogueList=dialogueList.filter(e=>e.ttl>0&&e.opacity>0)).forEach(e=>{e.update_render()})):gameAudio.changeVolumeOfMusic(.03)),"none"==document.getElementById("warning").style.display&&(environment.update_render(),UI.menu_render())}else if(0==levels_handler.level.total)levels_handler.level.waves>=levels_handler.waveCounter?(dialogueList=[],textIndex=void 0,levels_handler.waveCounter++,levels_handler.levelCreator(),spawn()):winTheLevel();else{if(ctx.clearRect(0,0,canvas.width,canvas.height),levelTimer++,levelEffectsHandler(),ctx.beginPath(),camera.update(),camera.check(),player.update(),background.update_render(),backgroundParticles.update_render(),player.render(),ctx.globalAlpha=1,player.spaceSize/screenratio>1201?ctx.strokeStyle="#5C7CFF":ctx.strokeStyle="cyan",ctx.lineWidth=5,ctx.globalAlpha=.7,ctx.strokeRect(player.earthX-player.spaceSize/2,player.earthY-player.spaceSize/2,player.spaceSize,player.spaceSize),environment.update_render(),bulletList.forEach((e,t)=>{e.killed?bulletList.splice(t,1):(e.explosive&&e.explosion_triggered&&e.explosion_render(),e.update(),(e.x>-50&&e.x<canvas.width+50&&e.y>-50&&e.y<canvas.height+50||"LASER"==e.name)&&e.render())}),enemyBulletList.forEach((e,t)=>{if("none"==e.target)var a=Math.sqrt(Math.pow(e.x-player.earthX,2)+Math.pow(e.y-player.earthY,2));collides(e,player)?player.HP[1]>0&&!player.hitCD&&!player.collisionCD&&"INVINCIBLEDRILL"!=player.weapon.name&&(e.piercing&&player.piercingCD||(player.shield[1]>=e.damage?player.shield[1]-=e.damage:(player.HP[1]+=-(e.damage-player.shield[1]),player.shield[1]=0),gameAudio.playSound("player_hit"),e.piercing?setTimer(e.hitCD,player,"piercingCD"):e.killed=!0,player.hitCD=!0,player.hitCDstart(1,"bullet"))):a<20&&"none"==e.target&&(player.shield[0]>=e.damage?player.shield[0]-=e.damage:(player.HP[0]+=-(e.damage-player.shield[0]),player.shield[0]=0),e.killed=!0,environment.warning_activation(),player.hitCDstart(0,"bullet")),e.update(),e.x>-50&&e.x<canvas.width+50&&e.y>-50&&e.y<canvas.height+50&&e.render(),e.killed&&enemyBulletList.splice(t,1)}),0==player.weaponDuration?(player.speed=player.defaultSpeed,player.animationFPS=5,player.width=75*screenratio,player.height=75*screenratio,chooseWeapon("BASIC"),gameAudio.gameAudioFiles.player_LASER_loop.paused||(gameAudio.gameAudioFilesplayer_LASER_loop.pause(),player.LASER_firing=!1),player.weaponDuration--):player.weaponDuration>0&&player.weaponDuration--,leftMouseDown){if(!player.attackCD&&player.HP[1]>0){if("LASER"!=player.weapon.name)try{gameAudio.playSound(player.weapon.sound)}catch(e){console.error("Missing an audio file.")}else 0==player.LASER_firing||null==player.LASER_firing?(player.LASER_firing=!0,gameAudio.playSound("player_LASER_start")):(gameAudio.gameAudioFiles.player_LASER_loop.loop=!0,gameAudio.gameAudioFiles.player_LASER_loop.play());bulletList.push(bullet(_objectSpread({},player.weapon),player.weapon.bullets)),setTimer(player.weapon.cooldown,player,"attackCD");for(let e=0;e<player.companions;e++)bulletList.push(bullet(_objectSpread({x:player.companionsX[e],y:player.companionsY[e],companion:!0},player.weapon),player.weapon.bullets))}}else gameAudio.gameAudioFiles.player_LASER_loop.paused||(gameAudio.gameAudioFiles.player_LASER_loop.pause(),player.LASER_firing=!1);enemyList.forEach((e,t)=>{e.deathAnimation||e.killed?e.killed?enemyList.splice(t,1):e.deathAnimation_render():(e.update(),e.x>-100&&e.x<canvas.width+100&&e.y>-100&&e.y<canvas.height+100&&(e.render(),collides(e,player)&&(player.collisionCD&&"collide"!=e.behaviour||player.hitCD||!(player.HP[1]>0)||(12!=playerData.level&&(e.HP>1?(e.HP--,e.hitCDstart()):(e.HP=0,checkDeath(e))),"INVINCIBLEDRILL"!=player.weapon.name&&(player.collisionCD=!0,player.shield[1]>=e.collisionDamage?player.shield[1]-=e.collisionDamage:(player.HP[1]+=-(e.collisionDamage-player.shield[1]),player.shield[1]=0),gameAudio.playSound("player_hit"),player.HP[1]>0&&player.hitCDstart(1,"collision"))))),bulletList.forEach(t=>{collides(e,t)&&(e.HP>0&&!t.killed&&("spawn"==e.behaviour&&!e.spawning&&!e.attackCD&&e.HP>t.damage&&e.spawns<e.maximumSpawns&&(e.spawning=!0,"mail"==e.type&&(e.speed=0),e.attackCDstart()),t.explosive&&!t.explosion_triggered?t.explode():t.piercing&&e.piercingCD||t.explosive||(e.HP-=t.damage,gameAudio.playSound("enemy_hit"),damageNumberList.push(new DamageNumber(t.damage,e.x,e.y)),e.hitCDstart(),t.piercing||(t.killed=!0)),e.piercingCD||e.piercingDamageCDstart(t.hitCD/(player.companions+1)),"CHAKRAM"==t.name&&t.speed>=5?t.speed-=5:"CHAKRAM"==t.name&&(t.speed=0)),checkDeath(e,t.name))}))}),damageNumberList.forEach((e,t)=>{e.update_render(),e.ttl<=0&&damageNumberList.splice(t,1)}),!lootCube.active&&levelTimer-lootCube.nextSpawn==0&&playerData.level>0&&(lootCube.active=!0,spawnAnEnemy("lootCube")),UI.game_render()}timerList.forEach((e,t)=>{e.createdInMenu==UI.inMenu&&(e.value>0?e.value--:(timerList[t].timerEnd(),timerList.splice(t,1)))}),ctx.closePath(),gameAudio.checkPausedSounds(),checkRefreshRate()&&requestAnimationFrame(gameLoop)}function startTheGame(){inicializeGame()}function warningClick(){document.getElementById("warning").style.display="none",gameAudio.playSound("click"),gameAudio.playMusic("music_menu"),UI.getMenuEffect(0)}function askAboutReset(){return!(playerData.level>0)||!!confirm("Are you sure you want to start a new game?\nYour current progress will reset!")&&(resetLocalStorage(),!0)}function getMenu(e){canvas.style.cursor="auto",UI.inMenu=!0,UI.globalCustomAlpha=0,UI.getMenuEffect(e)}function closeMenu(){UI.inMenu=!1}function loseTheGame(){gameAudio.stopMusic(),gameAudio.gameAudioFiles.player_LASER_loop.paused||(gameAudio.gameAudioFiles.player_LASER_loop.pause(),player.LASER_firing=!1),player.inWeaponActivation=!1,DialogueData.dialoguesUsed=[],timerList=[],player.inicialize(0,50),camera.inicialize(),background.inicialize(),backgroundParticles.inicialize(),environment.inicialize(),getMenu(2)}function winTheLevel(){player.inWeaponActivation=!1,player.HP=[player.maxHP[0],player.maxHP[1]],player.shield=[player.maxShield[0],player.maxShield[1]],player.playerLives=3;if (playerData.level < 9) player.setCompanions(Math.floor((playerData.level + 1) / 3));else player.setCompanions(3);weaponActivation.inicialize(),dialogueList=[],DialogueData.dialoguesUsed=[],textIndex=NaN,levelTimer=0,enemySpawnList=[],timerList=[],enemyList=[],lootCube.active=!1,lootCube.nextSpawn=1300,playerData.level<12?(playerData.level+=1,nextLevel()):(gameAudio.stopMusic(),player.inicialize(0,50),camera.inicialize(),background.inicialize(),backgroundParticles.inicialize(),environment.inicialize(),12==playerData.level?(getMenu(6),playerData.justiceending=!0):13==playerData.level&&(getMenu(7),playerData.revengeending=!0,gameAudio.playSound("revengeending")),playerData.level=11),saveLocalStorage()}function nextLevel(){playerData.level%3==0&&gameAudio.playMusic("music_level_"+Math.floor(playerData.level/3)),levels_handler.waveCounter=1,levels_handler.level=levelLayout["level_"+playerData.level],levels_handler.levelCreator(),spawn()}function sleep(e){return new Promise(t=>setTimeout(t,e))}function saveLocalStorage(){localStorage.playerData=JSON.stringify(playerData)}function resetLocalStorage(){let e=playerData.soundMultiplier,t=playerData.musicMultiplier;(playerData=new DefaultSetup).soundMultiplier=e,playerData.musicMultiplier=t,localStorage.playerData=JSON.stringify(playerData)}function newLocalStorage(){playerData=new DefaultSetup,localStorage.playerData=JSON.stringify(playerData)}function killAll(){enemyList=[],enemySpawnList=[],levels_handler.level.total=0}function hideMenuLinks(){let e=document.querySelectorAll(".link");for(let t=0;t<e.length;t++)e[t].style.display="none"}function showMenuLinks(){let e=document.querySelectorAll(".link");for(let t=0;t<e.length;t++)e[t].style.display=""}function collides(e,t){return e.hitBoxX<t.hitBoxX+t.hitBoxWidth&&e.hitBoxX+e.hitBoxWidth>t.hitBoxX&&e.hitBoxY<t.hitBoxY+t.hitBoxHeight&&e.hitBoxY+e.hitBoxHeight>t.hitBoxY}function collides_UI(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}function inicializeGame(){playerData.level<13?gameAudio.playMusic("music_level_"+Math.floor(playerData.level/3)):gameAudio.stopMusic(),hideMenuLinks(),UI.levelDisplayCheck=!0,DialogueData.dialoguesUsed=[],levelTimer=0,savedTimer=0,textIndex=void 0,dialogueList=[],bulletList=[],enemyList=[],enemyBulletList=[],timerList=[],lootCube.active=!1,lootCube.nextSpawn=1300,UI.beforeTheBossMenuTimer=0,weaponActivation.inicialize(),canvas.style.cursor="none",UI.inMenu=!1,player.inicialize(0,50),playerData.level<9?player.setCompanions(Math.floor(playerData.level/3)):player.setCompanions(3),enemySpawnList=[],levels_handler.waveCounter=1,levels_handler.level=levelLayout["level_"+playerData.level],levels_handler.levelCreator(),background.inicialize(),backgroundParticles.inicialize(),environment.inicialize(),spawn(),camera.inicialize()}null==localStorage.playerData&&newLocalStorage(),document.onreadystatechange=(()=>{"complete"==document.readyState&&loadTheGame()});var screenratio,canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");async function loadTheGame(){canvas.addEventListener("click",function(){UI.click()}),canvas.addEventListener("mousedown",function(){userInput(event,1)}),canvas.addEventListener("mouseup",function(){userInput(event,2)}),canvas.addEventListener("mousemove",function(){userInput(event,0)}),canvas.addEventListener("contextmenu",e=>e.preventDefault()),document.addEventListener("keydown",function(){userInput(event,1)}),document.addEventListener("keyup",function(){userInput(event,2)}),loadGameAssets(gameLoop)}function loadGameAssets(e){let t=0,a=[],i=document.querySelector(".loadingText"),r=document.querySelector(".loadingBar"),n=0;i.innerHTML="Inicializing...";for(let e in sprite)n++;let o=0;for(let e in gameAudio.gameAudioFiles)o++;let s=n+o;i.innerHTML="cube";for(let l in sprite){let h=l.split("_");"UI"==h[0]||"projectile"==h[0]?sprite[l].src="./sprites/"+h[0]+"/"+h[1]+".png":sprite[l].src="./sprites/"+h[0]+"/"+h[1]+"/"+h[1]+".png",a.push(h[1]),sprite[l].onload=function(){if(a.splice(0,1),null!=a[0]&&(i.innerHTML=a[0]),t++,r.style.width=14/s*t+"vw",t==n){let n=0;i.innerHTML="click";for(let l in gameAudio.gameAudioFiles)gameAudio.gameAudioFiles[l].src="./audio/"+l+".ogg",a.push(l),gameAudio.gameAudioFiles[l].oncanplaythrough=function(){if(n++,r.style.width=14/s*(t+n)+"vw",a.splice(0,1),null!=a[0]&&(i.innerHTML=a[0]),n==o){scale(),(playerData=JSON.parse(localStorage.playerData)).justiceending&&playerData.revengeending&&console.log(`${window.location.href}sprites/enemy/angelaPhase3/chatlog_3.log`),keyboardControler.inicialize(),player.inicialize(0,50),background.inicialize(),backgroundParticles.inicialize(),environment.inicialize(),camera.inicialize(),gameAudio.setVolume(),UI.inicialize(),document.getElementById("loading").style.display="none",e()}}}}}}function scale(){for(screenratio=1,canvas.width=1100,canvas.height=900;window.innerHeight<canvas.height||window.innerWidth<canvas.width;)screenratio-=.1,canvas.width=1100*screenratio,canvas.height=900*screenratio;canvas.width=window.innerWidth,canvas.height=window.innerHeight}var timerList=[];function setTimer(e,t,a,i=UI.inMenu){let r=Math.round(60*e/1e3);t[a]=!0,timerList.push(new Timer(r,t,a,i))}function setCallbackTimer(e,t,a=UI.inMenu){let i=Math.round(60*e/1e3);timerList.push(new CallbackTimer(i,t,a))}class Timer{constructor(e,t,a,i){this.value=e,this.reference=t,this.attributeName=a,this.createdInMenu=i}timerEnd(){this.reference[this.attributeName]=!1}}class CallbackTimer{constructor(e,t,a){this.value=e,this.callback=t,this.createdInMenu=a}timerEnd(){this.callback()}}async function spawn(){if(0==levelTimer&&11!=playerData.level){UI.levelDisplayCheck=!0,playerData.level<12?UI.levelDisplay.text=Math.floor(playerData.level/3)+1+"-"+(playerData.level%3+1):UI.levelDisplay.text="??-??";for(let e=1;e<=400;e++)e<=100?UI.levelDisplay.opacity=e/100:e>300&&e<=370&&(UI.levelDisplay.opacity=(370-e)/70),await sleep(10);UI.levelDisplayCheck=!1}null==levels_handler.level.startTime?setCallbackTimer(levels_handler.level["startTimeWave"+levels_handler.waveCounter],spawner,!1):setCallbackTimer(levels_handler.level.startTime,spawner,!1)}function spawner(){enemySpawnList.length>0&&(enemyList.push(enemyCharacter(_objectSpread({x:enemySpawnList[0].x*screenratio+player.earthX,y:enemySpawnList[0].y*screenratio+player.earthY},EnemyData[enemySpawnList[0].type]))),setCallbackTimer(enemySpawnList[0].spawnCD,spawner,!1),enemySpawnList.splice(0,1))}let enemySpawnList=[];var levels_handler={waveCounter:1,level:{},levelCreator:function(){for(let index in this.level)if("waves"!=index&&"startTime"!=index&&this.level[index][3]==this.waveCounter)for(let e=0;e<this.level[index][1];e++){let e=generateRandomSpawnPos();enemySpawnList.push({x:e[0],y:e[1],type:this.level[index][0],spawnCD:this.level[index][2]})}this.level.total=enemySpawnList.length,enemySpawnList.sort(function(){return.5-Math.random()})}};function generateRandomSpawnPos(){let e=[[-1,0,0,1],[0,-1,1,0],[1,0,0,1],[0,1,1,0]][Math.floor(4*Math.random())];return[e[0]*player.spaceSize/screenratio/2+e[2]*((Math.random()<.5?-1:1)*Math.random()*player.spaceSize/screenratio/2),e[1]*player.spaceSize/screenratio/2+e[3]*((Math.random()<.5?-1:1)*Math.random()*player.spaceSize/2)]}let lootCube={active:!1,nextSpawn:1300};function spawnAnEnemy(e,t=-1,a=-1,i=2*Math.PI*Math.random()){let r;if(r=-1==t&&-1==a?generateRandomSpawnPos():[t,a],"lootCubeTarget"==e){let t=3*Math.random();enemyList.push(enemyCharacter(_objectSpread(_objectSpread({x:r[0]*screenratio+player.earthX,y:r[1]*screenratio+player.earthY},EnemyData[e]),{},{playerOrbitAngle:i,defaultSpeed:(.005*Math.random()+.005)*(Math.random()>.5?1:-1),distanceFromPlayerX:t+2.5,distanceFromPlayerY:t+2.5})))}else enemyList.push(enemyCharacter(_objectSpread(_objectSpread({x:r[0]*screenratio+player.earthX,y:r[1]*screenratio+player.earthY},EnemyData[e]),{},{playerOrbitAngle:i})))}var levelLayout={level_0:{waves:3,startTimeWave1:3e4,startTimeWave2:100,startTimeWave3:13e3,miniArrow1:["miniArrow",5,1e3,1],miniArrow2:["miniArrow",5,1e3,2],cube1:["cube",3,2e3,2],cube2:["cube",5,2e3,3]},level_1:{waves:3,startTimeWave1:6e3,startTimeWave2:5e3,startTimeWave3:4500,cube1:["cube",8,1e3,1],mail1:["mail",2,2500,2],cube2:["cube",5,1e3,2],cube3:["cube",4,1e3,3],mail2:["mail",3,2500,3]},level_2:{waves:3,startTimeWave1:1e4,startTimeWave2:2e3,startTimeWave3:6e3,cube1:["cube",5,1e3,1],mail1:["mail",2,2500,1],mail2:["mail",3,2500,2],icosphere1:["icosphere",5,2e3,2],icosphere2:["icosphere",10,2e3,3]},level_3:{waves:3,startTimeWave1:14e3,startTimeWave2:2e4,startTimeWave3:3e3,cube1:["cube",5,1e3,1],betaCube1:["betaCube",5,2e3,1],cube2:["cube",6,1e3,2],betaCube2:["betaCube",5,2e3,2],watcher1:["watcher",2,4e3,2],icosphere3:["icosphere",8,1500,3],betaCube3:["betaCube",8,2e3,3],watcher2:["watcher",3,4e3,3]},level_4:{waves:3,startTimeWave1:1e4,startTimeWave2:3e3,startTimeWave3:7e3,betaMiniArrow1:["betaMiniArrow",8,1e3,1],betaCube1:["betaCube",5,2e3,1],watcher1:["watcher",5,3500,1],cube1:["cube",4,500,2],betaCube2:["betaCube",2,2e3,2],betaMail1:["betaMail",3,4e3,2],cube2:["cube",5,500,3],watcher2:["watcher",3,3500,3],icosphere1:["icosphere",5,1500,3],betaCube3:["betaCube",5,2e3,3],mail1:["mail",2,1e3,3],betaMail2:["betaMail",2,4e3,3]},level_5:{waves:3,startTimeWave1:2e4,startTimeWave2:11e3,startTimeWave3:12e3,cube1:["cube",5,500,1],betaCube1:["betaCube",4,2e3,1],watcher1:["watcher",3,3e3,1],betaCube2:["betaCube",8,2e3,2],watcher2:["watcher",3,3e3,2],icosphere:["icosphere",3,1500,3],betaCube3:["betaCube",7,3],star1:["star",3,3e3,3]},level_6:{waves:3,startTimeWave1:18e3,startTimeWave2:100,startTimeWave3:9e3,star1:["star",3,3e3,1],betaCube1:["betaCube",8,1500,1],watcher1:["watcher",3,1500,1],betaIcosphere1:["betaIcosphere",3,1500,2],betaCube1:["betaCube",5,1500,2],watcher2:["watcher",1,2500,2],star2:["star",3,3e3,2],betaIcosphere2:["betaIcosphere",6,1500,3],betaCube2:["betaCube",6,1500,3],cube1:["cube",6,500,3],icosphere1:["icosphere",6,500,3]},level_7:{waves:3,startTimeWave1:100,startTimeWave2:17500,startTimeWave3:1e4,betaMail1:["betaMail",6,1500,1],watcher1:["watcher",2,2e3,1],cube1:["cube",30,500,2],betaWatcher1:["betaWatcher",3,3e3,2],betaCube1:["betaCube",4,3],betaIcosphere1:["betaIcosphere",4,3],star1:["star",3,3],betaWatcher2:["betaWatcher",3,3e3,3]},level_8:{waves:3,startTimeWave1:22e3,startTimeWave2:33e3,startTimeWave3:100,betaWatcher1:["betaWatcher",10,4e3,1],betaIcosphere1:["betaIcosphere",7,2e3,2],betaWatcher2:["betaWatcher",3,3e3,2],betaStar1:["betaStar",3,4e3,2],betaMail1:["betaMail",3,3e3,3],betaStar2:["betaStar",3,4e3,3],betaCube1:["betaCube",10,2e3,3]},level_9:{waves:3,startTimeWave1:16e3,startTimeWave2:18e3,startTimeWave3:12500,betaWatcher1:["betaWatcher",5,2500,1],betaCube1:["betaCube",10,1e3,1],betaMail1:["betaMail",3,1500,1],betaIcosphere1:["betaIcosphere",6,1e3,1],carrier1:["carrier",2,300,2],betaCube2:["betaCube",10,1e3,2],betaIcosphere2:["betaIcosphere",10,1e3,2],carrier2:["carrier",3,300,3],betaMail2:["betaMail",6,1500,3],betaCube3:["betaCube",10,1e3,3],betaStar1:["betaStar",5,1500,3]},level_10:{waves:3,startTimeWave1:12e3,startTimeWave2:11500,startTimeWave3:9e3,carrier1:["carrier",5,3e3,1],betaCube1:["betaCube",20,1e3,1],betaIcosphere1:["betaIcosphere",5,1e3,1],betaCarrier1:["betaCarrier",2,3e3,2],betaCube2:["betaCube",5,1e3,2],carrier2:["carrier",4,3e3,2],betaIcosphere2:["betaIcosphere",5,1e3,3],betaStar1:["betaStar",5,2e3,3],betaCarrier2:["betaCarrier",5,3e3,3]},level_11:{waves:1,startTime:1e5,cube1:["cube",1,1,1]},level_12:{waves:3,startTimeWave1:12500,startTimeWave2:3e3,startTimeWave3:3e3,angela1:["angela_phase1",1,1,1],angela2:["angela_phase2",1,1,2],angela3:["angela_phase3",1,1,3]},level_13:{waves:15,startTimeWave1:11500,startTimeWave2:5e3,startTimeWave3:5e3,startTimeWave4:100,startTimeWave5:100,startTimeWave6:9e3,startTimeWave7:100,startTimeWave8:100,startTimeWave9:100,startTimeWave10:100,startTimeWave11:3e3,startTimeWave12:100,startTimeWave13:100,startTimeWave14:100,startTimeWave15:6e3,miniArrow1:["miniArrow",5,200,1],betaMiniArrow1:["betaMiniArrow",5,200,2],cube1:["cube",20,500,3],betaCube1:["betaCube",20,500,4],icosphere1:["icosphere",20,500,5],betaIcosphere1:["betaIcosphere",20,500,6],mail1:["mail",10,500,7],betaMail1:["betaMail",10,500,8],watcher1:["watcher",10,1e3,9],betaWatcher1:["betaWatcher",10,1e3,10],star1:["star",15,3e3,11],betaStar1:["betaStar",15,3e3,12],carrier1:["carrier",15,5e3,13],betaCarrier1:["betaCarrier",15,5e3,14],corruptedCloud1:["corruptedCloud",10,1e3,15]}},savedTimer=0;function levelEffectsHandler(){playerData.level>4&&playerData.level<12&&1==levelTimer&&(backgroundParticles.fan1.sprite=sprite.UI_motherboardFanRed,backgroundParticles.fan2.sprite=sprite.UI_motherboardFanRed),10==playerData.level?2==levels_handler.waveCounter&&0==savedTimer?savedTimer=levelTimer:savedTimer+420==levelTimer&&0!=savedTimer&&(Dialogue.stopDialogues=!0,environment.angelaJumpscare1.activated=!0,gameAudio.playSound("angelaJumpscare1")):11==playerData.level?1==levelTimer?(backgroundParticles.angelaCorrupted.visible=!0,backgroundParticles.angela.visible=!1):2200==levelTimer?(environment.angelaJumpscare2.activated=!0,gameAudio.playSound("angelaJumpscare2")):2230==levelTimer&&(levelTimer++,gameAudio.stopMusic(),gameAudio.gameAudioFiles.player_LASER_loop.paused||(gameAudio.gameAudioFiles.player_LASER_loop.pause(),player.LASER_firing=!1),saveLocalStorage(),player.inWeaponActivation=!1,textIndex=NaN,DialogueData.dialoguesUsed=[],player.inicialize(0,50),camera.inicialize(),background.inicialize(),backgroundParticles.inicialize(),environment.inicialize(),getMenu(5)):12==playerData.level?1==levelTimer?(environment.light.opacity=1,backgroundParticles.hole.visible=!0,backgroundParticles.angela.visible=!1):1e3==levelTimer&&(gameAudio.stopMusic(),gameAudio.playMusic("music_level_4_2"),gameAudio.currentMusic.currentTime=3.1):13==playerData.level&&(1==levelTimer?(backgroundParticles.angelaCorrupted.visible=!0,backgroundParticles.angela.visible=!1):3==levels_handler.waveCounter&&gameAudio.currentMusic.paused?gameAudio.playMusic("music_level_5"):15==levels_handler.waveCounter&&gameAudio.stopMusic())}var playerData,camera={inicialize:function(){this.x=0,this.y=0,this.offSetX=0,this.offSetY=0,this.offSetXNew=0,this.offSetYNew=0,this.offSetXOld=0,this.offSetYOld=0},update:function(){let e=Math.atan2(yMousePos-canvas.height/2,xMousePos-canvas.width/2),t=2*Math.sqrt(Math.pow(xMousePos-canvas.width/2,2)+Math.pow(yMousePos-canvas.height/2,2));this.x=t*Math.cos(e)+canvas.width/2,this.y=t*Math.sin(e)+canvas.height/2,this.offSetXNew=this.x-canvas.width/2,this.offSetYNew=this.y-canvas.height/2},check:function(){this.offSetX=Math.round(10*(this.offSetXNew-this.offSetXOld))/50*screenratio,this.offSetXOld=this.offSetXNew,this.offSetY=Math.round(10*(this.offSetYNew-this.offSetYOld))/50*screenratio,this.offSetYOld=this.offSetYNew}},player={setPos:function(e,t){this.x=canvas.width/2,this.y=canvas.height/2,this.coordX=this.spaceSize/2+e*screenratio,this.coordY=this.spaceSize/2+t*screenratio,this.earthX=canvas.width/2-e*screenratio,this.earthY=canvas.height/2-t*screenratio,this.futureX=e*screenratio,this.futureY=t*screenratio,this.xspeed=0,this.yspeed=0,this.accelerationX=0,this.accelerationY=0},inicialize:function(e,t){this.playerLives=3,this.starterPosX=e*screenratio,this.starterPosY=t*screenratio,this.defaultSpaceSize=4e3*screenratio,this.spaceSize=this.defaultSpaceSize,this.x=canvas.width/2,this.y=canvas.height/2,this.coordX=this.spaceSize/2+this.starterPosX,this.coordY=this.spaceSize/2+this.starterPosY,this.earthX=canvas.width/2-this.starterPosX,this.earthY=canvas.height/2-this.starterPosY,this.futureX=this.starterPosX,this.futureY=this.starterPosY,this.accelerationX=0,this.accelerationY=0,this.defaultSpeed=20,this.speed=this.defaultSpeed,this.xspeed=0,this.yspeed=0,this.width=75*screenratio,this.height=75*screenratio,this.widthOnPic=150,this.heightOnPic=150,this.animationX=0,this.animationY=0,this.maxHP=[100,50],this.HP=[this.maxHP[0],this.maxHP[1]],this.maxShield=[100,50],this.shield=[this.maxShield[0],this.maxShield[1]],this.angle=0,this.hitBoxWidth=this.width/3*2,this.hitBoxHeight=this.height/3*2,this.hitBoxX=this.x-this.hitBoxWidth/2,this.hitBoxY=this.y-this.hitBoxHeight/2,this.animationX=0,this.animationIndex=0,this.animationFrames=9,this.animationFPS=5,this.sprite=sprite.player_angel305,this.weapon=WeaponData.BASIC,this.weaponDuration=0,this.inWeaponActivation=!1,this.companionsX=[0,0,0],this.companionsY=[0,0,0],this.companionsIndex=[0,360/this.companions,720/this.companions],this.shieldCD=[0,0],this.attackCD=!1,this.hitCD=!1,this.collisionCD=!1,this.killedCD=!1,this.opacity=[1,1],this.damageOpacity=[0,0],this.piercingCD=!1,this.lastRatioX=0,this.lastRatioY=0},update:function(){this.shieldRecharge(),keyboardControler.active?this.ratioByKeyboard():this.ratioByMouse(),this.currentSpeed=player.speed*screenratio,this.targetxspeed=this.ratio*this.lastRatioX*this.accelerationX/100,this.targetyspeed=this.ratio*this.lastRatioY*this.accelerationY/100,this.HP[0]<=0||0==this.playerLives?(this.currentSpeed=0,this.xspeed=0,this.yspeed=0,13==playerData.level&&15==levels_handler.waveCounter?winTheLevel():loseTheGame()):this.HP[1]<=0&&!this.killedCD?13==playerData.level&&15==levels_handler.waveCounter?(this.currentSpeed=0,this.xspeed=0,this.yspeed=0,winTheLevel()):(this.killedCD=!0,this.killedCDstart()):isNaN(this.ratio)||((Math.abs(this.xspeed)<Math.abs(this.targetxspeed)||(this.xspeed>=0?1:-1)!=(this.targetxspeed>=0?1:-1))&&0!=this.targetxspeed?this.xspeed+=(this.targetxspeed>=0?1:-1)*(this.accelerationX/100)/2:this.xspeed>=.5?this.xspeed-=.5:this.xspeed<=-.5?this.xspeed+=.5:this.xspeed=0,(Math.abs(this.yspeed)<Math.abs(this.targetyspeed)||(this.yspeed>=0?1:-1)!=(this.targetyspeed>=0?1:-1))&&0!=this.targetyspeed?this.yspeed+=(this.targetyspeed>=0?1:-1)*(this.accelerationY/100)/2:this.yspeed>=.5?this.yspeed-=.5:this.yspeed<=-.5?this.yspeed+=.5:this.yspeed=0,this.futureX+=this.xspeed,this.futureY+=this.yspeed,Math.abs(this.futureX)<this.spaceSize/2&&Math.abs(this.futureY)<this.spaceSize/2?(this.coordX+=this.xspeed,this.coordY+=this.yspeed,this.hitBoxWidth=Math.abs(this.width/3*2*Math.pow(Math.cos(this.angle),2)+this.height/3*2*Math.pow(Math.sin(this.angle),2)),this.hitBoxHeight=Math.abs(this.width/3*2*Math.pow(Math.sin(this.angle),2)+this.height/3*2*Math.pow(Math.cos(this.angle),2)),this.hitBoxX=this.x-this.hitBoxWidth/2,this.hitBoxY=this.y-this.hitBoxHeight/2,this.earthX-=this.xspeed,this.earthY-=this.yspeed):(this.futureX-=this.xspeed,this.futureY-=this.yspeed,this.currentSpeed=0,this.xspeed=0,this.yspeed=0)),this.earthX-=camera.offSetX,this.earthY-=camera.offSetY,this.x-=camera.offSetX,this.y-=camera.offSetY,this.companionsIndex.forEach((e,t)=>{this.companionsIndex[t]+=2,this.companionsIndex[t]>=360&&(this.companionsIndex[t]=0)});let e="INVINCIBLEDRILL"!=this.weapon.name?50:100;for(let t=0;t<this.companions;t++)this.companionsX[t]=this.x+e*screenratio*Math.cos(this.companionsIndex[t]/180*Math.PI),this.companionsY[t]=this.y+e*screenratio*Math.sin(this.companionsIndex[t]/180*Math.PI)},render:function(){this.animationIndex+=1;let e=Math.round(300/this.animationFPS/(60*(this.accelerationX+this.accelerationY)/200));0==e&&(e=1),e==1/0&&(e=60/this.animationFPS),this.animationIndex==e&&(this.animationIndex=0,this.animationX<this.widthOnPic*(this.animationFrames-1)?this.animationX+=this.widthOnPic:this.animationX=0),this.animationIndex>e&&(this.animationIndex=0),ctx.save(),ctx.translate(this.x,this.y),this.angle=Math.atan2(yMousePos-this.y,xMousePos-this.x)+Math.PI/2,ctx.rotate(this.angle),ctx.globalAlpha=this.opacity[1]-this.damageOpacity[1],ctx.drawImage(this.sprite,this.animationX,0,this.widthOnPic,this.heightOnPic,-this.width/2,-this.height/2,this.width,this.height),this.HP[1]>0&&"INVINCIBLEDRILL"==this.weapon.name&&(ctx.globalAlpha=this.dodgeMeter/100*5,ctx.drawImage(this.sprite,this.animationX,2*this.heightOnPic,this.widthOnPic,this.heightOnPic,-this.width/2,-this.height/2,this.width,this.height)),this.HP[1]>0&&(ctx.globalAlpha=this.damageOpacity[1],ctx.drawImage(this.sprite,this.animationX,this.heightOnPic,this.widthOnPic,this.heightOnPic,-this.width/2,-this.height/2,this.width,this.height)),ctx.restore(),ctx.globalAlpha=1;for(let e=0;e<this.companions;e++)ctx.save(),ctx.translate(this.companionsX[e],this.companionsY[e]),ctx.rotate(this.angle),"INVINCIBLEDRILL"!=this.weapon.name?ctx.drawImage(sprite.player_companion,0,0,30,30,-15,-15,30,30):ctx.drawImage(sprite.player_companion,0,30,30,30,-30,-30,60,60),ctx.restore()},hitCDstart:async function(e,t){1==e?this.shieldCD[1]=300:this.shieldCD[0]=300,this.damageOpacity[e]=1.01;for(let a=100;a>=0&&(1==e&&"bullet"==t&&50==a&&(this.hitCD=!1),this.damageOpacity[e]==(a+1)/100);a--)this.damageOpacity[e]=a/100,await sleep(1);1==e&&"bullet"==t?this.hitCD=!1:1==e&&"collision"==t&&(this.collisionCD=!1)},shieldRecharge:function(){this.shieldCD[0]>0?this.shieldCD[0]--:this.shield[0]<this.maxShield[0]&&(this.shieldCD[0]=12,this.shield[0]+=1),this.shieldCD[1]>0?this.shieldCD[1]--:this.shield[1]<this.maxShield[1]&&(this.shieldCD[1]=6,this.shield[1]+=1)},killedCDstart:async function(){gameAudio.gameAudioFiles.player_LASER_loop.paused||(gameAudio.gameAudioFiles.player_LASER_loop.pause(),player.LASER_firing=!1),this.playerLives--,this.opacity[1]=.5,await sleep(5e3),this.HP[1]=this.maxHP[1],this.opacity[1]=1,this.killedCD=!1,this.collisionCD=!1},setCompanions:function(e){this.companions=e,this.companionsIndex=[0,360/e,720/e]},ratioByMouse:function(){let e=Math.sqrt(Math.pow(xMousePos-canvas.width/2,2)+Math.pow(yMousePos-canvas.height/2,2));e<160*screenratio&&!rightMouseDown?(this.accelerationX>=2?this.accelerationX-=2:this.accelerationX=0,this.accelerationY>=2?this.accelerationY-=2:this.accelerationY=0):e>=160*screenratio&&e<=210*screenratio&&!rightMouseDown?(this.accelerationX>=1?this.accelerationX-=1:this.accelerationX=0,this.accelerationY>=1?this.accelerationY-=1:this.accelerationY=0):rightMouseDown?(this.accelerationX>=.2?this.accelerationX-=.2:this.accelerationX=0,this.accelerationY>=.2?this.accelerationY-=.2:this.accelerationY=0):(this.accelerationX<=98?this.accelerationX+=2:this.accelerationX=100,this.accelerationY<=98?this.accelerationY+=2:this.accelerationY=100),rightMouseDown||(this.ratio=this.currentSpeed/(Math.abs(xMousePos-canvas.width/2)+Math.abs(yMousePos-canvas.height/2)),this.lastRatioX=xMousePos-canvas.width/2,this.lastRatioY=yMousePos-canvas.height/2)},ratioByKeyboard:function(e,t,a=!1){a?1==keyboardControler.buttonsActive?(this.ratio=this.currentSpeed/(Math.abs(e-canvas.width/2)+Math.abs(t-canvas.height/2)),this.lastRatioX=e-canvas.width/2,this.lastRatioY=t-canvas.height/2):keyboardControler.buttonsActive>1&&(this.ratio=(this.currentSpeed+10*screenratio)/(Math.abs(e-canvas.width/2)+Math.abs(t-canvas.height/2)),this.lastRatioX=e-canvas.width/2,this.lastRatioY=t-canvas.height/2):keyboardControler.buttonsActive>0?(this.accelerationX<=98?this.accelerationX+=2:this.accelerationX=100,this.accelerationY<=98?this.accelerationY+=2:this.accelerationY=100):(this.accelerationX>=2?this.accelerationX-=2:this.accelerationX=0,this.accelerationY>=2?this.accelerationY-=2:this.accelerationY=0)}},UI={inMenu:!0,currentMenu:0,inicialize:function(){this.globalCustomAlpha=0,this.globalCustomAlphaCheck=!1,this.mainMenu_sprite0={width:Math.round(353*screenratio),height:Math.round(184*screenratio),widthOnPic:353,heightOnPic:184,x:Math.round(canvas.width/2-176*screenratio),y:Math.round(canvas.height/2-400*screenratio),sprite:sprite.UI_logo,opacity:1,color:["grey","black","white"],animationX:0,animationY:0,timeIndex:15,animation:function(){this.timeIndex++,300==this.timeIndex&&(this.timeIndex=0),this.timeIndex<15?this.animationX=(Math.floor(this.timeIndex/2)+1)*this.widthOnPic:this.animationX=0}},this.mainMenu_b0={width:300*screenratio,height:50*screenratio,x:canvas.width/2-150*screenratio,y:canvas.height/2-150*screenratio,text:"NEW GAME",textSize:30*screenratio,button:"NEW GAME",opacity:1,color:["grey","black","white"]},this.mainMenu_b1={width:300*screenratio,height:50*screenratio,x:canvas.width/2-150*screenratio,y:canvas.height/2-80*screenratio,text:"CONTINUE",textSize:30*screenratio,button:"CONTINUE",opacity:.5,color:["grey","black","white"]},this.mainMenu_b2={width:300*screenratio,height:50*screenratio,x:canvas.width/2-150*screenratio,y:canvas.height/2-10*screenratio,text:"OPTIONS",textSize:30*screenratio,button:"OPTIONS",opacity:1,color:["grey","black","white"]},this.mainMenu=[this.mainMenu_b0,this.mainMenu_b1,this.mainMenu_b2,this.mainMenu_sprite0],this.optionsMenu_box0={width:300*screenratio,height:70*screenratio,x:canvas.width/2-150*screenratio,y:canvas.height/2-170*screenratio,textSize:30*screenratio,opacity:1,color:["grey","black","white"]},this.optionsMenu_box1={width:300*screenratio,height:70*screenratio,x:canvas.width/2-150*screenratio,y:canvas.height/2-87*screenratio,textSize:30*screenratio,opacity:1,color:["grey","black","white"]},this.optionsMenu_t0={width:0*screenratio,height:0*screenratio,x:canvas.width/2-50*screenratio,y:canvas.height/2-130*screenratio,text:"SOUND:",textSize:30*screenratio,opacity:1,color:["grey","black","white"]},this.optionsMenu_t1={width:0*screenratio,height:0*screenratio,x:canvas.width/2-50*screenratio,y:canvas.height/2-50*screenratio,text:"MUSIC:",textSize:30*screenratio,opacity:1,color:["grey","black","white"]},this.optionsMenu_t2={width:0*screenratio,height:0*screenratio,x:canvas.width/2+50*screenratio,y:canvas.height/2-130*screenratio,text:playerData.soundMultiplier,textSize:30*screenratio,opacity:1,color:["grey","black","white"]},this.optionsMenu_t3={width:0*screenratio,height:0*screenratio,x:canvas.width/2+50*screenratio,y:canvas.height/2-50*screenratio,text:playerData.musicMultiplier,textSize:30*screenratio,opacity:1,color:["grey","black","white"]},this.optionsMenu_b0={width:25*screenratio,height:25*screenratio,x:canvas.width/2+100*screenratio,y:canvas.height/2-165*screenratio,text:"🡅",button:"sound",textSize:20*screenratio,opacity:1,color:["grey","black","white"]},this.optionsMenu_b1={width:25*screenratio,height:25*screenratio,x:canvas.width/2+100*screenratio,y:canvas.height/2-130*screenratio,text:"🡇",button:"sound",textSize:20*screenratio,opacity:1,color:["grey","black","white"]},this.optionsMenu_b2={width:25*screenratio,height:25*screenratio,x:canvas.width/2+100*screenratio,y:canvas.height/2-82*screenratio,text:"🡅",button:"music",textSize:20*screenratio,opacity:1,color:["grey","black","white"]},this.optionsMenu_b3={width:25*screenratio,height:25*screenratio,x:canvas.width/2+100*screenratio,y:canvas.height/2-47*screenratio,text:"🡇",button:"music",textSize:20*screenratio,opacity:1,color:["grey","black","white"]},this.optionsMenu_b4={width:300*screenratio,height:50*screenratio,x:canvas.width/2-150*screenratio,y:canvas.height/2+5*screenratio,text:document.fullscreen?"FULLSCREEN":"WINDOWED",button:"DISPLAYMODE",textSize:30*screenratio,opacity:1,color:["grey","black","white"]},this.optionsMenu_b5={width:300*screenratio,height:50*screenratio,x:canvas.width/2-150*screenratio,y:canvas.height/2+80*screenratio,text:keyboardControler.active?"KEYBOARD + MOUSE":"MOUSE ONLY",button:"CONTROLS",textSize:20*screenratio,opacity:1,color:["grey","black","white"]},this.optionsMenu_b6={width:250*screenratio,height:50*screenratio,x:canvas.width/2-125*screenratio,y:canvas.height/2+155*screenratio,text:"BACK",button:"BACK",textSize:30*screenratio,opacity:1,color:["grey","black","white"]},this.optionsMenu=[this.optionsMenu_box0,this.optionsMenu_box1,this.optionsMenu_t0,this.optionsMenu_t1,this.optionsMenu_t2,this.optionsMenu_t3,this.optionsMenu_b0,this.optionsMenu_b1,this.optionsMenu_b2,this.optionsMenu_b3,this.optionsMenu_b4,this.optionsMenu_b5,this.optionsMenu_b6],this.gameOverMenuWindow={width:550*screenratio,height:250*screenratio,x:canvas.width/2-275*screenratio,y:canvas.height/2-150*screenratio,text:"GAME OVER",textSize:30*screenratio,opacity:1,color:["#4C4C4C","black","white"]},this.gameOverMenu_b0={width:250*screenratio,height:50*screenratio,x:canvas.width/2-265*screenratio,y:canvas.height/2+40*screenratio,text:"RETRY",textSize:30*screenratio,button:"RETRY",opacity:1,color:["grey","black","white"]},this.gameOverMenu_b1={width:250*screenratio,height:50*screenratio,x:canvas.width/2+15*screenratio,y:canvas.height/2+40*screenratio,text:"MENU",textSize:30*screenratio,button:"BACKTOMENU",opacity:1,color:["grey","black","white"]},this.gameOverMenu=[this.gameOverMenuWindow,this.gameOverMenu_b0,this.gameOverMenu_b1],this.creditsMenu_sprite0={width:600*screenratio,height:370*screenratio,widthOnPic:600,heightOnPic:370,x:canvas.width/2-300*screenratio,y:canvas.height/2-250*screenratio,sprite:sprite.UI_credits,opacity:1,color:["grey","black","white"],animationX:0,animationY:0},this.creditsMenu_b0={width:250*screenratio,height:50*screenratio,x:canvas.width/2-125*screenratio,y:canvas.height/2+140*screenratio,text:"MENU",textSize:30*screenratio,button:"BACKTOMENU",opacity:1,color:["grey","black","white"]},this.creditsMenu_b1={width:250*screenratio,height:22*screenratio,x:canvas.width/2-240*screenratio,y:canvas.height/2-10*screenratio,text:"",textSize:30*screenratio,button:"incompetech",opacity:.1,color:["grey","black","white"]},this.creditsMenu_b2={width:410*screenratio,height:22*screenratio,x:canvas.width/2-240*screenratio,y:canvas.height/2+37*screenratio,text:"",textSize:30*screenratio,button:"license",opacity:.1,color:["grey","black","white"]},this.creditsMenu=[this.creditsMenu_sprite0,this.creditsMenu_b0,this.creditsMenu_b1,this.creditsMenu_b2],this.pauseMenuWindow={width:550*screenratio,height:250*screenratio,x:canvas.width/2-275*screenratio,y:canvas.height/2-150*screenratio,text:"GAME PAUSED.",textSize:30*screenratio,opacity:1,color:["#4C4C4C","black","white"]},this.pauseMenu_b0={width:250*screenratio,height:50*screenratio,x:canvas.width/2-265*screenratio,y:canvas.height/2+40*screenratio,text:"MENU",textSize:30*screenratio,button:"BACKTOMENU",opacity:1,color:["grey","black","white"]},this.pauseMenu_b1={width:250*screenratio,height:50*screenratio,x:canvas.width/2+15*screenratio,y:canvas.height/2+40*screenratio,text:"RESUME",textSize:30*screenratio,button:"RESUME",opacity:1,color:["grey","black","white"]},this.pauseMenu=[this.pauseMenuWindow,this.pauseMenu_b0,this.pauseMenu_b1],this.beforeTheBossMenuTimer=0,this.beforeTheBossMenu_b1={width:320*screenratio,height:50*screenratio,x:canvas.width/2-315*screenratio,y:canvas.height/2+40*screenratio,text:"HELP ANGELA",textSize:30*screenratio,button:"NO",opacity:1,color:["grey","black","white"]},this.beforeTheBossMenu_b2={width:320*screenratio,height:50*screenratio,x:canvas.width/2+65*screenratio,y:canvas.height/2+40*screenratio,text:"DEFEAT ANGELA",textSize:30*screenratio,button:"YES",opacity:1,color:["grey","black","white"]},this.beforeTheBossMenu=[this.beforeTheBossMenu_b1,this.beforeTheBossMenu_b2],this.judgementEnding_sprite0={width:750*screenratio,height:955*screenratio,widthOnPic:750,heightOnPic:955,x:canvas.width/2-375*screenratio,y:canvas.height/2-477*screenratio,sprite:sprite.UI_judgementending,opacity:1,color:["grey","black","white"],animationX:0,animationY:0},this.judgementEnding_b0={width:320*screenratio,height:50*screenratio,x:canvas.width/2-160*screenratio,y:canvas.height/2+400*screenratio,text:"CREDITS",textSize:30*screenratio,button:"CREDITS",opacity:1,color:["grey","black","white"]},this.judgementEnding_b1={width:115*screenratio,height:40*screenratio,x:canvas.width/2-135*screenratio,y:canvas.height/2-220*screenratio,text:"",textSize:30*screenratio,button:"SECRET_1",opacity:.05,color:["grey","black","white"]},this.judgementEndingMenu=[this.judgementEnding_sprite0,this.judgementEnding_b0,this.judgementEnding_b1],this.revengeEnding_sprite0={width:750*screenratio,height:955*screenratio,widthOnPic:750,heightOnPic:955,x:canvas.width/2-375*screenratio,y:canvas.height/2-500*screenratio,sprite:sprite.UI_revengeending,opacity:1,color:["grey","black","white"],animationX:0,animationY:0},this.revengeEnding_b0={width:320*screenratio,height:50*screenratio,x:canvas.width/2-160*screenratio,y:canvas.height/2+400*screenratio,text:"CREDITS",textSize:30*screenratio,button:"CREDITS",opacity:1,color:["grey","black","white"]},this.revengeEnding_b1={width:100*screenratio,height:40*screenratio,x:canvas.width/2-320*screenratio,y:canvas.height/2+110*screenratio,text:"",textSize:30*screenratio,button:"SECRET_2",opacity:.1,color:["grey","black","white"]},this.revengeEndingMenu=[this.revengeEnding_sprite0,this.revengeEnding_b0,this.revengeEnding_b1],this.tutorial_b0={width:320*screenratio,height:50*screenratio,x:canvas.width/2-160*screenratio,y:canvas.height/2+300*screenratio,text:"NEXT",textSize:30*screenratio,button:"NEXT",opacity:1,color:["grey","black","white"]},this.tutorial_t0={width:0*screenratio,height:0*screenratio,x:canvas.width/2,y:canvas.height/2-378*screenratio,text:"Movement",textSize:30*screenratio,opacity:1,color:["grey","black","white"]},this.tutorial_sprite0={width:870*screenratio,height:590*screenratio,widthOnPic:870,heightOnPic:590,x:canvas.width/2-435*screenratio,y:canvas.height/2-350*screenratio,sprite:sprite.UI_tutorial,opacity:1,color:["grey","black","white"],animationX:0,animationY:0},this.tutorialHandler={index:0,text:["Movement","Enemies","Weapon acquisition"]},this.tutorialMenu=[this.tutorial_b0,this.tutorial_sprite0,this.tutorial_t0],this.levelDisplay={x:canvas.width/2,y:300*screenratio,textSize:120*screenratio,opacity:0,color:"white"},this.levelDisplayCheck=!1,this.UIColors={fill:"grey",stroke:"#333333",fontFill:"white",fontStroke:"black",hoverFill:"#5C7CFF",hoverStroke:"#B2B5FF",hoverFontFill:"white",hoverFontStroke:"#B2B5FF",selectedFill:"grey",selectedStroke:"white",selectedFontFill:"white",selectedFontStroke:"red",sliderFill:"#40FF40",sliderStroke:"#414141"},this.HPbar_player={color:""},this.HPbar_earth={color:""},this.HPpanel={width:260*screenratio,height:96*screenratio,x:canvas.width-260*screenratio,y:0,sprite:sprite.UI_HPpanel},this.dangerLight_0={width:10*screenratio,height:10*screenratio,x:canvas.width-20*screenratio,y:20*screenratio},this.dangerLight_1={width:10*screenratio,height:10*screenratio,x:canvas.width-20*screenratio,y:50*screenratio},this.duration_panel={width:240*screenratio,height:55*screenratio,x:canvas.width-240*screenratio,y:canvas.height-55*screenratio,sprite:sprite.UI_durationPanel},this.minimapLayer={width:206*screenratio,height:206*screenratio,x:-3*screenratio,y:-3*screenratio,lineWidth:6*screenratio,color:["#686C70","#1D1D1D"]},this.menuList=[this.mainMenu,this.optionsMenu,this.gameOverMenu,this.creditsMenu,this.pauseMenu,this.beforeTheBossMenu,this.judgementEndingMenu,this.revengeEndingMenu,this.tutorialMenu],this.cursorIndex=0},menu_render:function(){let e=this.menuList[this.currentMenu];this.hover(),5==this.currentMenu&&this.beforeTheBossMenuTimer++,playerData.level>0?this.mainMenu_b1.opacity=1:this.mainMenu_b1.opacity=.5,e.forEach(e=>{(5!=this.currentMenu||this.beforeTheBossMenuTimer>5290)&&(ctx.fillStyle=e.color[0],ctx.strokeStyle=e.color[1],null!=e.textSize&&(ctx.lineWidth=6*screenratio),this.globalCustomAlphaCheck&&e.opacity>this.globalCustomAlpha?ctx.globalAlpha=this.globalCustomAlpha:ctx.globalAlpha=e.opacity,null==e.sprite&&null==e.textOnly&&(ctx.strokeRect(e.x,e.y,e.width,e.height),ctx.fillRect(e.x,e.y,e.width,e.height)),ctx.fillStyle=e.color[2],null!=e.text&&(ctx.font=e.textSize+"px FFFFORWA",ctx.textAlign="center",ctx.strokeText(e.text,e.x+e.width/2,e.y+e.height/2+e.textSize/2+e.height/14),ctx.fillText(e.text,e.x+e.width/2,e.y+e.height/2+e.textSize/2+e.height/14)),null!=e.sprite&&null==e.button&&(null!=e.animation&&e.animation(),ctx.drawImage(e.sprite,e.animationX,e.animationY,e.widthOnPic,e.heightOnPic,e.x,e.y,e.width,e.height)))})},game_render:function(){ctx.globalAlpha=1,ctx.fillStyle="#0A0A0A",ctx.fillRect(canvas.width-210*screenratio,20*screenratio,190*screenratio,50*screenratio);let e=parseInt(player.HP[1]/player.maxHP[1]*255).toString(16);1==e.length&&(e="0"+e),this.HPbar_player.color="#F1"+e+e;let t=parseInt(player.HP[0]/player.maxHP[0]*255).toString(16);if(1==t.length&&(e="0"+t),this.HPbar_earth.color="#F1"+t+t,ctx.fillStyle=this.HPbar_player.color,ctx.fillRect(canvas.width-155*screenratio,51*screenratio,player.HP[1]/player.maxHP[1]*(120*player.maxHP[1]/(player.maxHP[1]+player.maxShield[1]))*screenratio,16*screenratio),ctx.fillStyle="#5C7CFF",ctx.fillRect(canvas.width-155*screenratio+player.HP[1]/player.maxHP[1]*(120*player.maxHP[1]/(player.maxHP[1]+player.maxShield[1]))*screenratio,51*screenratio,player.shield[1]/player.maxShield[1]*(120*player.maxShield[1]/(player.maxHP[1]+player.maxShield[1]))*screenratio,16*screenratio),ctx.fillStyle=this.HPbar_earth.color,ctx.fillRect(canvas.width-195*screenratio,21*screenratio,player.HP[0]/player.maxHP[0]*(160*player.maxHP[0]/(player.maxHP[0]+player.maxShield[0]))*screenratio,16*screenratio),ctx.fillStyle="#5C7CFF",ctx.fillRect(canvas.width-195*screenratio+player.HP[0]/player.maxHP[0]*(160*player.maxHP[0]/(player.maxHP[0]+player.maxShield[0]))*screenratio,21*screenratio,player.shield[0]/player.maxShield[0]*(160*player.maxShield[0]/(player.maxHP[0]+player.maxShield[0]))*screenratio,16*screenratio),"BASIC"!=player.weapon.name&&(ctx.fillStyle="black",ctx.fillRect(canvas.width-155*screenratio,canvas.height-30*screenratio,120*screenratio,20*screenratio),ctx.fillStyle="#5C7CFF",ctx.fillRect(canvas.width-155*screenratio,canvas.height-25*screenratio,player.weaponDuration/player.weapon.duration*120*screenratio,15*screenratio),ctx.drawImage(this.duration_panel.sprite,this.duration_panel.x,this.duration_panel.y,this.duration_panel.width,this.duration_panel.height)),playerData.level<12?ctx.drawImage(this.HPpanel.sprite,this.HPpanel.x,this.HPpanel.y,this.HPpanel.width,this.HPpanel.height):ctx.drawImage(sprite.UI_HPpanelError,this.HPpanel.x,this.HPpanel.y,this.HPpanel.width,this.HPpanel.height),ctx.font=13*screenratio+"px FFFFORWA",ctx.strokeStyle="#5C7CFF",ctx.fillStyle="white",ctx.fillText(player.playerLives+"x",canvas.width-195*screenratio,67*screenratio),UI.levelDisplayCheck&&(ctx.globalAlpha=UI.levelDisplay.opacity,ctx.textAlign="center",ctx.font=UI.levelDisplay.textSize+"px FFFFORWA",ctx.strokeStyle="black",ctx.strokeText(UI.levelDisplay.text,UI.levelDisplay.x,UI.levelDisplay.y),ctx.fillStyle=UI.levelDisplay.color,ctx.fillText(UI.levelDisplay.text,UI.levelDisplay.x,UI.levelDisplay.y),ctx.globalAlpha=1),ctx.globalAlpha=1,ctx.drawImage(sprite.UI_motherboardMap,this.minimapLayer.x,this.minimapLayer.y,this.minimapLayer.width,this.minimapLayer.height),ctx.fillStyle="red",enemyList.forEach(e=>{e.deathAnimation||e.killed||(ctx.save(),ctx.translate(e.coordX/(player.defaultSpaceSize/(200*screenratio)),e.coordY/(player.defaultSpaceSize/(200*screenratio))),ctx.rotate(e.angle),ctx.drawImage(e.minimapIcon,-3.5,-3.5,7,7)),ctx.restore()}),ctx.fillStyle="#DCE6EE",ctx.strokeStyle="#5C7CFF",ctx.lineWidth=1,ctx.moveTo(3,player.coordY/(player.defaultSpaceSize/(200*screenratio))),ctx.lineTo(200*screenratio,player.coordY/(player.defaultSpaceSize/(200*screenratio))),ctx.moveTo(player.coordX/(player.defaultSpaceSize/(200*screenratio)),3),ctx.lineTo(player.coordX/(player.defaultSpaceSize/(200*screenratio)),200*screenratio),ctx.stroke(),ctx.fillRect(player.coordX/(player.defaultSpaceSize/(200*screenratio))-2.5,player.coordY/(player.defaultSpaceSize/(200*screenratio))-2.5,5,5),ctx.strokeStyle=this.minimapLayer.color[1],ctx.lineWidth=this.minimapLayer.lineWidth*screenratio,ctx.strokeRect(this.minimapLayer.x,this.minimapLayer.y,this.minimapLayer.width,this.minimapLayer.height),player.inWeaponActivation&&weaponActivation.render_update(),dialogueHandler(),dialogueList.length>0){"white"==dialogueList[0].color||("#adadad"==dialogueList[0].color||"cyan"==dialogueList[0].color)&&playerData.level<12?backgroundParticles.angelaDialogueBubble.visible=!0:backgroundParticles.angelaDialogueBubble.visible=!1,gameAudio.changeVolumeOfMusic(.01);let e=!0;dialogueList.forEach(t=>{Dialogue.stopDialogues||t.update_render(),t.ttl>0&&(e=!1)}),e&&(dialogueList=[])}else backgroundParticles.angelaDialogueBubble.visible=!1,gameAudio.changeVolumeOfMusic(.03);this.cursorIndex+=.001*Math.sqrt(Math.pow(player.accelerationX,2)+Math.pow(player.accelerationY,2))+.02,ctx.globalAlpha=1,ctx.save(),ctx.translate(xMousePos,yMousePos),ctx.rotate(this.cursorIndex),leftMouseDown?ctx.drawImage(sprite.UI_cursorFire,-30,-30,60,60):ctx.drawImage(sprite.UI_cursorNoFire,-30,-30,60,60),ctx.restore(),6==this.cursorIndex&&(this.cursorIndex=0)},click:function(){this.globalCustomAlphaCheck||(0==this.currentMenu&&this.inMenu?this.mainMenu.forEach(e=>{if(collides_UI(e,{x:xMousePos,y:yMousePos,width:1,height:1})&&null!=e.button)if(gameAudio.playSound("click"),"NEW GAME"==e.button){askAboutReset()&&(hideMenuLinks(),this.tutorialHandler.index=0,this.tutorial_sprite0.animationX=0,playerData.keyboardControl||(this.tutorial_sprite0.animationY=590),this.tutorial_b0.text="NEXT",this.getMenuEffect(8))}else"CONTINUE"==e.button?playerData.level>0&&this.closeMenuEffect(startTheGame):"OPTIONS"==e.button&&this.getMenuEffect(1)}):1==this.currentMenu&&this.inMenu?this.optionsMenu.forEach(e=>{collides_UI(e,{x:xMousePos,y:yMousePos,width:1,height:1})&&null!=e.button&&("BACK"==e.button?(gameAudio.playSound("click"),this.getMenuEffect(0)):"CONTROLS"==e.button?(gameAudio.playSound("click"),keyboardControler.active=!keyboardControler.active,playerData.keyboardControl=!playerData.keyboardControl,saveLocalStorage(),e.text=keyboardControler.active?"KEYBOARD + MOUSE":"MOUSE ONLY"):"DISPLAYMODE"==e.button?(gameAudio.playSound("click"),document.fullscreen?document.exitFullscreen():canvas.requestFullscreen().catch(e=>{console.log(e)})):"sound"==e.button?("🡅"==e.text&&playerData.soundMultiplier<10?playerData.soundMultiplier++:"🡇"==e.text&&playerData.soundMultiplier>0&&playerData.soundMultiplier--,gameAudio.setVolume(),gameAudio.playSound("player_BASIC"),this.optionsMenu_t2.text=playerData.soundMultiplier):"music"==e.button&&("🡅"==e.text&&playerData.musicMultiplier<10?(playerData.musicMultiplier++,gameAudio.changeVolumeOfMusic(.03)):"🡇"==e.text&&playerData.musicMultiplier>0&&(playerData.musicMultiplier--,gameAudio.changeVolumeOfMusic(.03)),this.optionsMenu_t3.text=playerData.musicMultiplier),saveLocalStorage())}):2==this.currentMenu&&this.inMenu?this.gameOverMenu.forEach(e=>{collides_UI(e,{x:xMousePos,y:yMousePos,width:1,height:1})&&null!=e.button&&(gameAudio.playSound("click"),"BACKTOMENU"==e.button?(showMenuLinks(),gameAudio.playMusic("music_menu"),this.getMenuEffect(0)):"RETRY"==e.button&&this.closeMenuEffect(startTheGame))}):3==this.currentMenu&&this.inMenu?this.creditsMenu.forEach(e=>{collides_UI(e,{x:xMousePos,y:yMousePos,width:1,height:1})&&null!=e.button&&(gameAudio.playSound("click"),"BACKTOMENU"==e.button?(gameAudio.playMusic("music_menu"),this.getMenuEffect(0)):"incompetech"==e.button?window.open("https://incompetech.com/"):"license"==e.button&&window.open("http://creativecommons.org/licenses/by/3.0/"))}):4==this.currentMenu&&this.inMenu?this.pauseMenu.forEach(e=>{collides_UI(e,{x:xMousePos,y:yMousePos,width:1,height:1})&&null!=e.button&&(gameAudio.playSound("click"),"BACKTOMENU"==e.button?(this.getMenuEffect(0),gameAudio.playMusic("music_menu"),showMenuLinks(),player.inWeaponActivation=!1,player.inicialize(0,50),camera.inicialize(),background.inicialize(),backgroundParticles.inicialize()):"RESUME"==e.button&&(gameAudio.resumeMusic(),canvas.style.cursor="none",this.closeMenuEffect(closeMenu)))}):5==this.currentMenu&&this.inMenu?this.beforeTheBossMenu.forEach(e=>{collides_UI(e,{x:xMousePos,y:yMousePos,width:1,height:1})&&null!=e.button&&(gameAudio.playSound("click"),"NO"==e.button?(playerData.level+=2,this.closeMenuEffect(startTheGame)):"YES"==e.button&&(playerData.level+=1,this.closeMenuEffect(startTheGame)))}):6==this.currentMenu&&this.inMenu?this.judgementEndingMenu.forEach(e=>{collides_UI(e,{x:xMousePos,y:yMousePos,width:1,height:1})&&null!=e.button&&(gameAudio.playSound("click"),"CREDITS"==e.button?(showMenuLinks(),this.getMenuEffect(3)):"SECRET_1"==e.button&&window.open(`${window.location.href}sprites/enemy/angelaPhase1/chatlog_1.log`))}):7==this.currentMenu&&this.inMenu?this.revengeEndingMenu.forEach(e=>{collides_UI(e,{x:xMousePos,y:yMousePos,width:1,height:1})&&null!=e.button&&(gameAudio.playSound("click"),"CREDITS"==e.button?(showMenuLinks(),this.getMenuEffect(3)):"SECRET_2"==e.button&&window.open(`${window.location.href}sprites/enemy/angelaPhase2/chatlog_2.log`))}):8==this.currentMenu&&this.inMenu&&this.tutorialMenu.forEach(e=>{collides_UI(e,{x:xMousePos,y:yMousePos,width:1,height:1})&&null!=e.button&&(gameAudio.playSound("click"),"NEXT"==e.button&&(this.tutorialHandler.index<2?(this.tutorialHandler.index++,this.tutorial_sprite0.animationY=0,this.tutorial_sprite0.animationX+=870,this.tutorial_t0.text=this.tutorialHandler.text[this.tutorialHandler.index],2==this.tutorialHandler.index&&(e.text="START")):this.closeMenuEffect(startTheGame)))}))},hover:function(){let e=!1;0==this.currentMenu?this.mainMenu.forEach(t=>{collides_UI(t,{x:xMousePos,y:yMousePos,width:1,height:1})&&null!=t.button?"CONTINUE"==t.button&&playerData.level>0?(e=!0,t.color[0]=this.UIColors.hoverFill,t.color[1]=this.UIColors.hoverStroke,t.color[2]=this.UIColors.hoverFontFill):"CONTINUE"!=t.button&&(e=!0,t.color[0]=this.UIColors.hoverFill,t.color[1]=this.UIColors.hoverStroke,t.color[2]=this.UIColors.hoverFontFill):(t.color[0]=this.UIColors.fill,t.color[1]=this.UIColors.stroke,t.color[2]=this.UIColors.fontFill)}):1==this.currentMenu?this.optionsMenu.forEach(t=>{collides_UI(t,{x:xMousePos,y:yMousePos,width:1,height:1})&&null!=t.button?(e=!0,t.color[0]=this.UIColors.hoverFill,t.color[1]=this.UIColors.hoverStroke,t.color[2]=this.UIColors.hoverFontFill):(t.color[0]=this.UIColors.fill,t.color[1]=this.UIColors.stroke,t.color[2]=this.UIColors.fontFill)}):2==this.currentMenu?this.gameOverMenu.forEach(t=>{collides_UI(t,{x:xMousePos,y:yMousePos,width:1,height:1})&&null!=t.button?(e=!0,t.color[0]=this.UIColors.hoverFill,t.color[1]=this.UIColors.hoverStroke,t.color[2]=this.UIColors.hoverFontFill):("GAME OVER"!=t.text&&(t.color[0]=this.UIColors.fill),t.color[1]=this.UIColors.stroke,t.color[2]=this.UIColors.fontFill)}):3==this.currentMenu?this.creditsMenu.forEach(t=>{collides_UI(t,{x:xMousePos,y:yMousePos,width:1,height:1})&&null!=t.button?(e=!0,t.color[0]=this.UIColors.hoverFill,t.color[1]=this.UIColors.hoverStroke,t.color[2]=this.UIColors.hoverFontFill):("GAME COMPLETED!"!=t.text&&(t.color[0]=this.UIColors.fill),t.color[1]=this.UIColors.stroke,t.color[2]=this.UIColors.fontFill)}):4==this.currentMenu?this.pauseMenu.forEach(t=>{collides_UI(t,{x:xMousePos,y:yMousePos,width:1,height:1})&&null!=t.button?(e=!0,t.color[0]=this.UIColors.hoverFill,t.color[1]=this.UIColors.hoverStroke,t.color[2]=this.UIColors.hoverFontFill):("GAME PAUSED."!=t.text&&(t.color[0]=this.UIColors.fill),t.color[1]=this.UIColors.stroke,t.color[2]=this.UIColors.fontFill)}):5==this.currentMenu?this.beforeTheBossMenu.forEach(t=>{collides_UI(t,{x:xMousePos,y:yMousePos,width:1,height:1})&&null!=t.button?(e=!0,t.color[0]=this.UIColors.hoverFill,t.color[1]=this.UIColors.hoverStroke,t.color[2]=this.UIColors.hoverFontFill):(t.color[0]=this.UIColors.fill,t.color[1]=this.UIColors.stroke,t.color[2]=this.UIColors.fontFill)}):6==this.currentMenu?this.judgementEndingMenu.forEach(t=>{collides_UI(t,{x:xMousePos,y:yMousePos,width:1,height:1})&&null!=t.button?(e=!0,t.color[0]=this.UIColors.hoverFill,t.color[1]=this.UIColors.hoverStroke,t.color[2]=this.UIColors.hoverFontFill):(t.color[0]=this.UIColors.fill,t.color[1]=this.UIColors.stroke,t.color[2]=this.UIColors.fontFill)}):7==this.currentMenu?this.revengeEndingMenu.forEach(t=>{collides_UI(t,{x:xMousePos,y:yMousePos,width:1,height:1})&&null!=t.button?(e=!0,t.color[0]=this.UIColors.hoverFill,t.color[1]=this.UIColors.hoverStroke,t.color[2]=this.UIColors.hoverFontFill):(t.color[0]=this.UIColors.fill,t.color[1]=this.UIColors.stroke,t.color[2]=this.UIColors.fontFill)}):8==this.currentMenu&&this.tutorialMenu.forEach(t=>{collides_UI(t,{x:xMousePos,y:yMousePos,width:1,height:1})&&null!=t.button?(e=!0,t.color[0]=this.UIColors.hoverFill,t.color[1]=this.UIColors.hoverStroke,t.color[2]=this.UIColors.hoverFontFill):(t.color[0]=this.UIColors.fill,t.color[1]=this.UIColors.stroke,t.color[2]=this.UIColors.fontFill)}),canvas.style.cursor=e?"pointer":"default"},cooldown:async function(e){e.opacity=1;for(let t=1;t<=e.cooldown/10&&(await sleep(10),t==e.cooldown/10&&(e.opacity=0),0!=e.opacity);t++);},getMenuEffect:async function(e){if(this.globalCustomAlphaCheck=!0,0!=this.globalCustomAlpha){for(;this.globalCustomAlpha>0;this.globalCustomAlpha-=.06)await sleep(10);this.globalCustomAlpha=0}for(this.currentMenu=e;this.globalCustomAlpha<1;this.globalCustomAlpha+=.06)await sleep(10);this.globalCustomAlpha=1,this.globalCustomAlphaCheck=!1},closeMenuEffect:async function(e){for(this.globalCustomAlphaCheck=!0;this.globalCustomAlpha>0;this.globalCustomAlpha-=.06)await sleep(10);this.globalCustomAlpha=0,this.globalCustomAlphaCheck=!1,e()}};function chooseWeapon(e){player.weapon=WeaponData[e],player.weaponDuration=player.weapon.duration,"INVINCIBLEDRILL"==player.weapon.name&&(player.speed=20,player.animationFPS=60,player.width=150*screenratio,player.height=150*screenratio)}var weaponActivation={inicialize:function(){this.weaponName="DOUBLE",this.failTimeIndex=0,this.successTimeIndex=0,this.timerIndex=0,this.targets=0},defaultTimerIndex:660,render_update:function(){if(this.timerIndex--,0==this.timerIndex&&0==this.successTimeIndex)gameAudio.playSound("player_loseWeapon"),this.failTimeIndex=120,this.targets=-1;else if(0==this.targets&&0==this.successTimeIndex)this.successTimeIndex=120,gameAudio.playSound("player_getWeapon"),chooseWeapon(this.weaponName);else if(this.timerIndex>0&&0==this.successTimeIndex){ctx.globalAlpha=1,ctx.textAlign="center",ctx.font=50*screenratio+"px Consolas",ctx.fillText(`Targets: ${this.targets}`,canvas.width/2-50*screenratio,canvas.height/6),ctx.beginPath(),ctx.arc(canvas.width/2+175*screenratio,canvas.height/6-15*screenratio,20*screenratio,0,this.timerIndex/this.defaultTimerIndex*2*Math.PI,!1);let e=parseInt(this.timerIndex/this.defaultTimerIndex*255).toString(16);1==e.length&&(e="0"+e),ctx.strokeStyle="#FF"+e+e,ctx.lineWidth=10,ctx.stroke(),ctx.closePath()}else this.failTimeIndex>0?this.fail_render():this.successTimeIndex>0&&this.success_render()},fail_render:function(){this.failTimeIndex--,this.lives>0?(ctx.fillStyle="red",ctx.globalAlpha=this.failTimeIndex/120,ctx.fillRect(0,0,canvas.width,canvas.height),ctx.globalAlpha=1):1==this.failTimeIndex?(this.failTimeIndex=0,player.inWeaponActivation=!1,this.targets=0):(ctx.fillStyle="red",ctx.globalAlpha=this.failTimeIndex/this.defaultTimerIndex,ctx.fillRect(0,0,canvas.width,canvas.height),ctx.globalAlpha=1,ctx.textAlign="center",ctx.fillStyle="red",ctx.font=30*screenratio+"px FFFFORWA",ctx.globalAlpha=1,ctx.fillText("FAIL",canvas.width/2,canvas.height/4))},success_render:function(){this.successTimeIndex--,ctx.fillStyle="white",ctx.globalAlpha=this.successTimeIndex/(2*this.defaultTimerIndex),ctx.fillRect(0,0,canvas.width,canvas.height),ctx.globalAlpha=1,ctx.textAlign="center",ctx.fillStyle="white",ctx.font=30*screenratio+"px FFFFORWA",ctx.globalAlpha=1,ctx.fillText(`SUCCESS: ${this.weaponName}`,canvas.width/2,canvas.height/4),0==this.successTimeIndex&&(player.inWeaponActivation=!1)}},bulletList=[];function bullet(e,t){switch(null==e.x&&(e.x=player.x+8*screenratio*Math.cos(player.angle-Math.PI/2),e.y=player.y+8*screenratio*Math.sin(player.angle-Math.PI/2)),e.dirx,e.killed=!1,e.angle=Math.atan2(e.diry,e.dirx)+Math.PI/2,e.speed=e.speed*screenratio+Math.abs(player.xspeed)+Math.abs(player.yspeed),e.damage=Math.round(e.damage*(e.companion?.5:1)),e.damageFallOff=Math.round(e.damageFallOff*(e.companion?.5:1)),e.width=e.widthOnPic*screenratio*(e.companion?.5:1),e.height=e.heightOnPic*screenratio*(e.companion?.5:1),e.opacity=1,e.rotationAngle=0,e.animationX=0,e.animationIndex=0,e.animationAngle=0,e.damage=e.damage-Math.round(Math.random()*e.damageFallOff),e.index){case 0:e.dirx=Math.cos(player.angle-Math.PI/2),e.diry=Math.sin(player.angle-Math.PI/2);break;case 1:2==t?(e.dirx=Math.cos(player.angle-Math.PI/2+1/180*Math.PI),e.diry=Math.sin(player.angle-Math.PI/2+1/180*Math.PI)):1==t&&(e.dirx=Math.cos(player.angle-Math.PI/2-1/180*Math.PI),e.diry=Math.sin(player.angle-Math.PI/2-1/180*Math.PI)),t>1&&bulletList.push(bullet(_objectSpread({x:e.x,y:e.y,companion:e.companion},player.weapon),t-1));break;case 2:3==t?(e.dirx=Math.cos(player.angle-Math.PI/2),e.diry=Math.sin(player.angle-Math.PI/2)):2==t?(e.dirx=Math.cos(player.angle-Math.PI/2+3/180*Math.PI),e.diry=Math.sin(player.angle-Math.PI/2+3/180*Math.PI)):1==t&&(e.dirx=Math.cos(player.angle-Math.PI/2-3/180*Math.PI),e.diry=Math.sin(player.angle-Math.PI/2-3/180*Math.PI)),t>1&&bulletList.push(bullet(_objectSpread({x:e.x,y:e.y,companion:e.companion},player.weapon),t-1));break;case 3:e.dirx=Math.cos(player.angle-Math.PI/2),e.diry=Math.sin(player.angle-Math.PI/2),e.explosion_radius=150*screenratio,e.explosion_triggered=!1,e.explosion_countdown=0,e.explosion_index=0,e.explosion_angle=2*Math.random()*Math.PI;break;case 4:e.dirx=Math.cos(player.angle-Math.PI/2),e.diry=Math.sin(player.angle-Math.PI/2);break;case 5:e.shootingPointX=e.x,e.shootingPointY=e.y;break;case 6:e.dirx=Math.cos(player.angle-Math.PI/2),e.diry=Math.sin(player.angle-Math.PI/2);break;case 7:e.dirx=Math.cos(player.angle-Math.PI/2+(Math.random()-.5)*Math.PI/6),e.diry=Math.sin(player.angle-Math.PI/2+(Math.random()-.5)*Math.PI/6);break;case 8:e.dirx=Math.cos(player.angle-Math.PI/2),e.diry=Math.sin(player.angle-Math.PI/2)}return e.hitBoxWidth=e.width/3*2,e.hitBoxHeight=e.height/3*2,e.hitBoxX=e.x-e.hitBoxWidth/2,e.hitBoxY=e.y-e.hitBoxHeight/2,e.update=function(){if("LASER"==e.name){let t=e.x,a=e.y;e.dirx=Math.cos(player.angle-Math.PI/2),e.diry=Math.sin(player.angle-Math.PI/2);let i=9/(Math.abs(e.dirx)+Math.abs(e.diry));for(let r=0;r<200;r++)t+=e.dirx*i,a+=e.diry*i,enemyList.forEach(i=>{!i.piercingCD&collides(i,{hitBoxX:t-e.width/2,hitBoxY:a-e.height/2,hitBoxWidth:e.width,hitBoxHeight:e.height})&&(i.piercingDamageCDstart(e.hitCD/(player.companions+1)),damageNumberList.push(new DamageNumber(e.damage,i.x,i.y)),i.HP-=e.damage,i.hitCDstart(),checkDeath(i,e.name))});e.x=t,e.y=a}else{e.rotationAnimation&&(e.rotationAngle+=e.rotationSpeed/180*Math.PI,e.rotationAngle>2*Math.PI&&(e.rotationAngle=0,"CHAKRAM"==e.name&&e.speed>0&&(e.damage=Math.floor(e.damage*Math.random())+1,e.speed-=1),e.speed<0&&(e.speed=0))),e.animation&&(e.animationIndex++,e.animationIndex%e.animationUpdate==0&&(e.animationIndex=0,e.animationX++),e.animationX==e.animationFrames&&(e.animationX=0));let t=e.speed/(Math.abs(e.dirx)+Math.abs(e.diry));e.xspeed=t*e.dirx,e.yspeed=t*e.diry,e.hitBoxWidth=Math.abs(e.width/3*2*Math.pow(Math.cos(e.angle),2)+e.height/3*2*Math.pow(Math.sin(e.angle),2)),e.hitBoxHeight=Math.abs(e.width/3*2*Math.pow(Math.sin(e.angle),2)+e.height/3*2*Math.pow(Math.cos(e.angle),2)),e.x+=e.xspeed-player.xspeed-camera.offSetX,e.y+=e.yspeed-player.yspeed-camera.offSetY,e.hitBoxX=e.x-e.hitBoxWidth/2,e.hitBoxY=e.y-e.hitBoxHeight/2}e.calcTTL()},e.render=function(){"LASER"==e.name?(ctx.save(),ctx.globalAlpha=1,ctx.strokeStyle=e.color,ctx.lineWidth=e.width*screenratio,ctx.moveTo(e.shootingPointX+20*Math.cos(player.angle-Math.PI/2)*screenratio,e.shootingPointY+20*Math.sin(player.angle-Math.PI/2)*screenratio),ctx.lineTo(e.x,e.y),ctx.stroke(),ctx.restore()):e.explosion_triggered||(ctx.save(),ctx.translate(e.x,e.y),e.angle=Math.atan2(e.diry,e.dirx)+Math.PI/2+e.rotationAngle,ctx.rotate(e.angle),ctx.globalAlpha=e.opacity,null!=e.sprite?ctx.drawImage(e.sprite,0+e.widthOnPic*e.animationX,0,e.widthOnPic,e.heightOnPic,-e.width/2,-e.height/2,e.width,e.height):(ctx.fillStyle=e.color,ctx.fillRect(-e.width/2,-e.height/2,e.width,e.height)),ctx.restore())},e.explode=function(){e.explosion_triggered=!0,gameAudio.playSound("explosion"),e.speed=0,enemyList.forEach(t=>{collides(t,{hitBoxX:e.x-e.explosion_radius/2,hitBoxY:e.y-e.explosion_radius/2,hitBoxWidth:e.explosion_radius,hitBoxHeight:e.explosion_radius})&&(t.HP-=e.damage,t.hitCDstart(),checkDeath(t,"MISSILE"))})},e.explosion_render=function(){e.killed||(e.explosion_countdown+=1,e.explosion_countdown%5==0&&(e.explosion_angle=2*Math.random()*Math.PI,e.explosion_index+=1),ctx.globalAlpha=1,ctx.save(),ctx.translate(e.x,e.y),ctx.rotate(e.explosion_angle),ctx.drawImage(sprite.projectile_explosion,0,e.explosion_radius/screenratio*e.explosion_index,150,150,-75*screenratio,-75*screenratio,e.explosion_radius,e.explosion_radius),ctx.restore(),11==e.explosion_index&&(e.killed=!0))},e.calcTTL=function(){e.ttl>0?e.ttl-=1:e.killed=!0},e}